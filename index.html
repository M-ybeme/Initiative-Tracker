<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The DM's Toolbox: Initiative Tracker</title>

  <!-- Bootstrap + Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
  <!-- Custom CSS -->
  <link href="/css/site.css" rel="stylesheet" />
  <link href="/css/initiative.css" rel="stylesheet" />

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/images/dndFavicon (2).png" />
  <script src="/js/site.js"></script>

</head>
<body class="bgimage">
  <!-- Nav -->
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top text-light" id="mainNav">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">
        <img src="/images/dndFavicon (2).png" height="40" width="40" alt="App Logo" class="d-inline-block" />
        The DM's Toolbox
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
        data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
        aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link active" aria-current="page" href="index.html">Initiative</a></li>
          <li class="nav-item"><a class="nav-link" href="name.html">Name Gen</a></li>
          <li class="nav-item"><a class="nav-link" href="loot.html">Loot Gen</a></li>
          <li class="nav-item"><a class="nav-link" href="shop.html">Shop Gen</a></li>
          <li class="nav-item"><a class="nav-link" href="npc.html">NPC Gen</a></li>
          <li class="nav-item"><a class="nav-link" href="tav.html">Tavern/Inn Gen</a></li>
          <li class="nav-item"><a class="nav-link" href="battlemap.html">Battle Map</a></li>
          <li class="nav-item"><a class="nav-link" href="encounterbuilder.html">Encounter Builder</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main -->
  <main class="content pt-3">
    <div class="container-fluid text-center backdrop">
            <h1 class="display-1 mb-0">Initiative Tracker</h1>
      <p class="lead">Manage initiative, health, AC, notes, status effects, and combat rounds.</p>
      <p id="playerViewBanner" class="text-info fw-semibold d-none">
        Player View: sensitive info hidden
      </p>


      <!-- Controls row -->
      <div class="row g-3 align-items-center justify-content-center my-2">
        <div class="col-12 col-xl-7">
          <div class="controls-grid">
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="autoSaveToggle" checked>
              <label class="form-check-label" for="autoSaveToggle">Auto-Save</label>
            </div>
          
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="lockOrderToggle">
              <label class="form-check-label" for="lockOrderToggle">Lock Order</label>
            </div>
          
            <button id="manualSaveBtn" class="btn btn-outline-success w-100">Manual Save</button>
            <button id="copyOrderBtn" class="btn btn-outline-light w-100">Copy Turn Order</button>
          
            <select id="saveHistorySelect" class="form-select w-100">
              <option disabled selected>Load Previous Save</option>
            </select>
          
            <div class="d-none">
              <input type="file" id="import-file" accept=".json" />
            </div>
          
            <button id="export-btn" class="btn btn-outline-warning w-100">Export Session</button>
            <button id="import-btn" class="btn btn-outline-secondary w-100">Import Session</button>

            <button class="btn btn-outline-success w-100"
                    data-bs-toggle="modal" data-bs-target="#savedCharsModal">
                    <div class="">
                      Saved Character Templates
                    </div>
            </button>

            <button class="btn btn-outline-light w-100"
                    data-bs-toggle="modal" data-bs-target="#rulesModal">
              <i class="bi bi-journal-bookmark me-1"></i> Rules / Spells
            </button>

            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="playerViewToggle">
              <label class="form-check-label" for="playerViewToggle">Player View</label>
            </div>

            <button id="helpBtn" class="btn btn-info text-dark w-100" type="button"
                    data-bs-toggle="offcanvas" data-bs-target="#helpCanvas" aria-controls="helpCanvas">
              <i class="bi bi-question-circle me-1"></i> Help
            </button>

          </div>
        </div>

      </div><!-- /controls row -->

      <!-- Add row -->
      <form id="initiative-form" class="mb-4">
        <div class="row g-2 justify-content-center">
          <div class="col-12 col-md-3"><input id="character-name" class="form-control" type="text" placeholder="Character Name" required></div>
          <div class="col-6 col-md-2"><input id="initiative-roll" class="form-control" type="number" placeholder="Initiative"></div>
          <div class="col-6 col-md-2"><input id="character-health" class="form-control" type="number" placeholder="Max HP"></div>
          <div class="col-6 col-md-2"><input id="character-ac" class="form-control" type="number" placeholder="AC"></div>
          <div class="col-6 col-md-2">
            <select id="character-type" class="form-select">
              <option>PC</option>
              <option>Companion</option>
              <option>NPC</option>
              <option>Enemy</option>
            </select>
          </div>
          <div class="col-12 col-md-1"><button class="btn btn-outline-success w-100" type="submit">Add</button></div>
        </div>
      </form>

      <h2>Combat Round: <span id="combat-round">1</span></h2>

      <!-- Dice Roller -->
      <div class="my-4 text-light">
        <div class="d-flex justify-content-center gap-2 flex-wrap">
          <button class="btn btn-outline-info dice-btn" data-dice="4">Roll d4</button>
          <button class="btn btn-outline-info dice-btn" data-dice="6">Roll d6</button>
          <button class="btn btn-outline-info dice-btn" data-dice="8">Roll d8</button>
          <button class="btn btn-outline-info dice-btn" data-dice="10">Roll d10</button>
          <button class="btn btn-outline-info dice-btn" data-dice="12">Roll d12</button>
          <button class="btn btn-outline-info dice-btn" data-dice="20">Roll d20</button>
          <button class="btn btn-outline-info dice-btn" data-dice="100">Roll d100</button>
          <button class="btn btn-outline-info" id="roll-adv">Adv (d20)</button>
          <button class="btn btn-outline-info" id="roll-dis">Dis (d20)</button>
        </div>
        <div class="mt-3">
          <label for="custom-dice-input" class="form-label">Custom Roll:</label>
          <div class="input-group w-auto mx-auto">
            <input id="custom-dice-input" type="text" class="form-control form-control-sm"
             placeholder="e.g. 2d6+1d4+3, 4d6kh3, adv" aria-label="Custom dice expression">
            <button id="roll-custom-dice" class="btn btn-outline-warning btn-sm">Roll</button>
          </div>
          <div class="form-text text-secondary">
            Supports multi-terms, +/−, keep high/low (kh/kl), and adv/dis.
            Examples: <code>2d6+1d4+3</code>, <code>4d6kh3</code>, <code>2d20kl1</code>, <code>adv</code>
          </div>
        </div>
        <div class="text-light mt-2" id="dice-result" style="font-size: 1.25rem;"></div>
        <div class="mt-3">
          <button class="btn btn-outline-light btn-sm" data-bs-toggle="collapse" data-bs-target="#dice-history">Toggle Roll History</button>
          <button class="btn btn-outline-danger btn-sm" id="clear-dice-history">Clear Dice History</button>
          <div class="collapse mt-2" id="dice-history">
            <div class="card card-body bg-dark text-light" id="dice-history-log" style="max-height: 200px; overflow-y: auto;"></div>
          </div>
        </div>
      </div>

      <!-- Desktop Table -->
      <div class="d-none d-md-block">
        <div class="table-responsive">
          <table class="table table-striped text-light align-middle">
            <thead>
              <tr>
                <th class="col-drag"></th>
                <th class="col-turn">Turn</th>
                <th class="col-name">Character</th>
                <th class="col-type">Type</th>
                <th class="col-init">Initiative</th>
                <th class="col-ac">AC</th>
                <th class="col-health">Health</th>
                <th class="col-notes">Notes & Effects</th>
                <th class="col-actions">Actions</th>
              </tr>
            </thead>
            <tbody id="initiative-order"></tbody>
          </table>
        </div>
      </div>

      <!-- Mobile Cards -->
      <div id="mobile-initiative-order" class="d-block d-md-none"></div>

      <!-- Footer action buttons -->
      <div class="mt-3 d-flex gap-2 justify-content-center flex-wrap">
        <button id="next-turn" class="btn btn-outline-success">Next Turn</button>
        <button id="undo-btn" class="btn btn-outline-secondary"><i class="bi bi-arrow-counterclockwise me-1"></i> Undo</button>
        <button id="reset-turns" class="btn btn-outline-danger">Reset Rounds</button>
        <button id="clear-all" class="btn btn-outline-light">Clear All</button>
        <button id="clear-storage" class="btn btn-outline-warning">Clear Saved Data</button>
        <button class="btn btn-outline-light" type="button" data-bs-toggle="offcanvas" data-bs-target="#sessionNotes" aria-controls="sessionNotes">
          <i class="bi bi-journal-text me-1"></i> Session Notes
        </button>
      </div>

    </div>
  </main>

  <!-- Status Modal -->
  <div class="modal fade" id="statusModal" tabindex="-1" aria-labelledby="statusModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 class="modal-title" id="statusModalLabel">Edit Status Effects</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Current effects -->
          <div id="status-badges" class="mb-3 d-flex flex-wrap gap-2"></div>

          <!-- Add effect -->
          <div class="input-group mb-2">
            <button class="btn btn-outline-light dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
              Add Effect
            </button>
            <ul class="dropdown-menu dropdown-menu-dark" id="status-dropdown-list"></ul>
            <input id="status-duration" type="number" min="0" class="form-control" placeholder="Duration (rounds, optional)">
            <button id="add-status-btn" class="btn btn-outline-success">Add</button>
          </div>
          <div class="form-text text-secondary">Leave duration blank for indefinite effects. Effects with a duration tick down each new round.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Notes Modal -->
  <div class="modal fade" id="notesModal" tabindex="-1" aria-labelledby="notesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 class="modal-title" id="notesModalLabel">Notes</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <textarea id="notes-text" class="form-control" rows="8" placeholder="Enter notes..."></textarea>
        </div>
        <div class="modal-footer">
          <button id="notes-save-btn" class="btn btn-success">Save Notes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Session Notes Offcanvas -->
  <div class="offcanvas offcanvas-end text-bg-dark" tabindex="-1" id="sessionNotes" aria-labelledby="sessionNotesLabel">
    <div class="offcanvas-header">
      <h5 id="sessionNotesLabel">Session Notes</h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body d-flex flex-column">
      <textarea id="session-notes" class="form-control mb-3" rows="10" placeholder="Enter your session notes..."></textarea>
      <div class="d-flex justify-content-between gap-2">
        <button id="save-notes" class="btn btn-outline-success w-100">Save</button>
        <button id="export-notes" class="btn btn-outline-warning w-100">Export</button>
        <button id="import-notes" class="btn btn-outline-secondary w-100">Import</button>
      </div>
      <input type="file" id="import-notes-file" class="d-none" accept=".txt,.md,.json" />
    </div>
  </div>

  <!-- Saved Characters Modal -->
  <div class="modal fade" id="savedCharsModal" tabindex="-1" aria-labelledby="savedCharsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 class="modal-title" id="savedCharsModalLabel">
            Saved Character Templates (Max: <span id="savedMaxLabel">200</span>)
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <div class="row g-2">
            <div class="col-md-3"><input id="save-name" class="form-control" type="text" placeholder="Name" /></div>
            <div class="col-md-2"><input id="save-health" class="form-control" type="number" placeholder="Max HP" /></div>
            <div class="col-md-2"><input id="save-ac" class="form-control" type="number" placeholder="AC" /></div>
            <div class="col-md-3">
              <select id="save-type" class="form-select">
                <option>PC</option>
                <option>Companion</option>
                <option>NPC</option>
                <option>Enemy</option>
              </select>
            </div>
            <div class="col-md-2">
              <button id="save-character-btn" class="btn btn-outline-success w-100">Save Template</button>
            </div>
          </div>

          <div class="row g-2 mt-2">
            <div class="col-sm-6">
              <input id="saved-search" class="form-control" type="text" placeholder="Search saved characters..." />
            </div>
            <div class="col-sm-6 d-flex gap-2 justify-content-sm-end">
              <select id="saved-type-filter" class="form-select w-auto">
                <option value="">All Types</option>
                <option>PC</option>
                <option>Companion</option>
                <option>NPC</option>
                <option>Enemy</option>
              </select>
              <button id="clear-saved-btn" class="btn btn-outline-danger">Clear All</button>
            </div>
          </div>

          <div class="row g-2 mt-2">
            <div class="col-md-6">
              <select id="loadCharacterSelect" class="form-select">
                <option disabled selected>Load Saved Character</option>
              </select>
            </div>
            <div class="col-md-6 d-flex gap-2">
              <button id="load-to-form-btn" class="btn btn-outline-light w-100">Load to Form</button>
              <button id="add-to-tracker-btn" class="btn btn-outline-success w-100">Add to Tracker</button>
            </div>
          </div>

          <ul id="saved-characters-list" class="list-group mt-3"></ul>
        </div>

        <div class="modal-footer">
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

<!-- Help Offcanvas -->
<div class="offcanvas offcanvas-start text-bg-dark" tabindex="-1" id="helpCanvas" aria-labelledby="helpCanvasLabel">
  <div class="offcanvas-header">
    <h5 id="helpCanvasLabel" class="mb-0"><i class="bi bi-magic me-2"></i>How to Use</h5>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>

  <div class="offcanvas-body">
    <!-- Alert-Info header (matches help color on other pages) -->
    <div class="alert alert-info text-light">
      <strong>Quick Start:</strong> Add at least a name, hit <em>Add</em>, then click <em>Next Turn</em>.
      Use the HP +/- to track damage or healing. Click the <i class="bi bi-star-fill"></i> to toggle Concentration.
    </div>

    <!-- Help Accordion -->
    <div class="accordion" id="helpAccordion">

      <div class="accordion-item bg-dark text-light border-secondary">
        <h2 class="accordion-header">
          <button class="accordion-button collapsed bg-dark text-light" type="button" data-bs-toggle="collapse" data-bs-target="#helpGettingStarted">
            Getting Started
          </button>
        </h2>
        <div id="helpGettingStarted" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
          <div class="accordion-body">
            <ol class="mb-0">
              <li>Enter at least a <strong>Character Name</strong>. <strong>Initiative</strong>, <strong>Max HP</strong>, and <strong>AC</strong> are optional (blank values default to 0).</li>
              <li>Repeat for each combatant. The list sorts by initiative unless <em>Lock Order</em> is enabled.</li>
              <li>Press <strong>Next Turn</strong> to advance through the order; after everyone acts, the <em>Combat Round</em> increases.</li>
            </ol>
          </div>
        </div>
      </div>

      <div class="accordion-item bg-dark text-light border-secondary">
        <h2 class="accordion-header">
          <button class="accordion-button collapsed bg-dark text-light" type="button" data-bs-toggle="collapse" data-bs-target="#helpHP">
            Health, Damage, & Concentration
          </button>
        </h2>
        <div id="helpHP" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
          <div class="accordion-body">
            <ul class="mb-2">
              <li>Use <strong>HP +/-</strong> to apply damage or healing, or type directly into the HP field.</li>
              <li><strong>Temp HP</strong> (THP) appears as a badge next to HP with its own <em>±</em> buttons.
                  Damage consumes THP first; only leftover damage reduces real HP.</li>
              <li>Click the <strong>star</strong> <i class="bi bi-star"></i>/<i class="bi bi-star-fill text-warning"></i> to toggle <strong>Concentration</strong>.</li>
              <li><strong>Concentration checks</strong> track the total real HP damage a creature takes during its turn and prompt you at the end of that turn with the correct DC.</li>
              <li><strong>Healing</strong> above 0 HP automatically resets any death saves and removes <em>Stable</em>.</li>
            </ul>
            <div class="alert alert-info text-light mb-0">
              <strong>Concentration DC:</strong> Roll <em>d20 + CON mod</em> (+ proficiency if proficient)
              vs <strong>DC = max(10, ⌊damage this turn / 2⌋)</strong>.
            </div>
          </div>
        </div>
      </div>

      <div class="accordion-item bg-dark text-light border-secondary">
        <h2 class="accordion-header">
          <button class="accordion-button collapsed bg-dark text-light" type="button" data-bs-toggle="collapse" data-bs-target="#helpDeathSaves">
            Death Saves
          </button>
        </h2>
        <div id="helpDeathSaves" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
          <div class="accordion-body">
            <ul class="mb-2">
              <li>When a creature drops to 0 HP, a <strong>Death Saves</strong> control appears:
                  <span class="ds-pill success">S: #</span> and <span class="ds-pill fail">F: #</span>.</li>
              <li>Use <strong>+S</strong> / <strong>+F</strong> to record successes or fails; use ↺ to reset them.</li>
              <li>At <strong>3 successes</strong>, the creature becomes <em>Stable</em> (shown as “Stable”).</li>
              <li><strong>Any healing</strong> that brings the creature above 0 HP clears all death saves and removes <em>Stable</em>.</li>
            </ul>
            <p class="small text-secondary mb-0">Note: the tracker does not auto-apply instant death from massive damage; handle that manually as DM.</p>
          </div>
        </div>
      </div>

      <div class="accordion-item bg-dark text-light border-secondary">
        <h2 class="accordion-header">
          <button class="accordion-button collapsed bg-dark text-light" type="button" data-bs-toggle="collapse" data-bs-target="#helpStatuses">
            Status Effects & Notes
          </button>
        </h2>
        <div id="helpStatuses" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
          <div class="accordion-body">
            <ul class="mb-0">
              <li>Click the <strong>smiley</strong> <i class="bi bi-emoji-smile"></i> to add/remove conditions (e.g., Prone, Poisoned) with optional <strong>duration (rounds)</strong>.</li>
              <li>Durations tick down automatically at the start of each new round; expired effects are removed.</li>
              <li>Click <strong>Notes</strong> <i class="bi bi-journal-text"></i> to store character-specific reminders.</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="accordion-item bg-dark text-light border-secondary">
        <h2 class="accordion-header">
          <button class="accordion-button collapsed bg-dark text-light" type="button" data-bs-toggle="collapse" data-bs-target="#helpDice">
            Dice Roller
          </button>
        </h2>
        <div id="helpDice" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
          <div class="accordion-body">
            <ul class="mb-0">
              <li>Use quick buttons for d4, d6, d8, d10, d12, d20, or d100.</li>
              <li>Use the custom box for complex rolls like <code>2d6+1d4+3</code>, <code>4d6kh3</code> (keep highest 3), or <code>2d20kl1</code> (disadvantage).</li>
              <li>Shortcuts: <code>adv</code> = 2d20 keep highest 1, <code>dis</code> = 2d20 keep lowest 1.</li>
              <li>All rolls show a toast with the result and log into the roll history panel.</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="accordion-item bg-dark text-light border-secondary">
        <h2 class="accordion-header" id="helpTemplatesHeader">
          <button class="accordion-button collapsed bg-dark text-light" type="button"
                  data-bs-toggle="collapse" data-bs-target="#helpTemplates"
                  aria-expanded="false" aria-controls="helpTemplates">
            Saved Character Templates
          </button>
        </h2>
        <div id="helpTemplates" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
          <div class="accordion-body">
            <ul class="mb-0">
              <li>Save up to <strong>200</strong> frequently used characters with AC/HP/type. Names must be unique; saving an existing name updates it.</li>
              <li>Search, filter by type, and quickly <em>Load to Form</em> or <em>Add to Tracker</em>.</li>
              <li>Use <strong>Clear All</strong> in the Saved Characters modal if you want to wipe just the templates (without touching the active encounter).</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="accordion-item bg-dark text-light border-secondary">
        <h2 class="accordion-header">
          <button class="accordion-button collapsed bg-dark text-light" type="button" data-bs-toggle="collapse" data-bs-target="#helpSaving">
            Saving, History, Import/Export
          </button>
        </h2>
        <div id="helpSaving" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
          <div class="accordion-body">
            <ul class="mb-0">
              <li><strong>Auto-Save</strong> keeps your current session in sync as you edit.</li>
              <li><strong>Manual Save</strong> creates a timestamped backup you can reload from <em>Load Previous Save</em>.</li>
              <li><strong>Export Session</strong> downloads a JSON; <strong>Import Session</strong> loads a previous file.</li>
              <li><strong>Undo</strong> rolls back the most recent HP / THP change, notes edit, status tweak, reorder, etc. (about 50 steps; history is not kept after a page reload).</li>
              <li><strong>Clear Saved Data</strong> wipes everything stored locally for this tool: sessions, templates, and session notes.</li>
              <li><strong>Cross-tab sync:</strong> if you have this page open in multiple tabs or windows, changes in one will automatically sync to the others.</li>
              <li><strong>From Encounter Builder:</strong> if you send an encounter from the Encounter Builder, the next time you open the tracker it will replace the current session with that built encounter.</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="accordion-item bg-dark text-light border-secondary">
        <h2 class="accordion-header">
          <button class="accordion-button collapsed bg-dark text-light" type="button" data-bs-toggle="collapse" data-bs-target="#helpTurns">
            Initiative, Turn Order & Rounds
          </button>
        </h2>
        <div id="helpTurns" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
          <div class="accordion-body">
            <ul class="mb-0">
              <li>Edit initiative inline; order re-sorts unless <em>Lock Order</em> is on.</li>
              <li>Drag rows (grab the ⋮⋮ handle on the left on Desktop) or use up/down (mobile) to reorder.</li>
              <li><strong>Next Turn</strong> advances through the order; when you wrap around to the first creature, the round counter increases and status durations tick down.</li>
              <li>While <strong>Lock Order</strong> is on, editing initiative values won’t re-sort the list and drag-reordering is disabled.</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="accordion-item bg-dark text-light border-secondary">
        <h2 class="accordion-header">
          <button class="accordion-button collapsed bg-dark text-light" type="button" data-bs-toggle="collapse" data-bs-target="#helpPlayerView">
            Player View / Second Screen
          </button>
        </h2>
        <div id="helpPlayerView" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
          <div class="accordion-body">
            <ul class="mb-0">
              <li>Use the <strong>Player View</strong> toggle to hide sensitive info (HP numbers, actions, dice roller, DM controls) and show a cleaner “scoreboard”.</li>
              <li>For a TV or second monitor: open this page in a second window, turn on <strong>Player View</strong> there, and leave it off in your main DM window.</li>
              <li>Both windows stay in sync automatically via the built-in cross-tab syncing: advancing turns or editing HP on the DM side updates the Player View.</li>
              <li>Lock Order still works in Player View; you can toggle it from either window.</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="accordion-item bg-dark text-light border-secondary">
        <h2 class="accordion-header">
          <button class="accordion-button collapsed bg-dark text-light" type="button" data-bs-toggle="collapse" data-bs-target="#helpRulesSpells">
            Rules & Spells Reference
          </button>
        </h2>
        <div id="helpRulesSpells" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
          <div class="accordion-body">
            <ul class="mb-0">
              <li>Use the <strong>Rules / Spells</strong> button above the tracker to open a side modal with quick rules summaries and SRD-safe spell overviews.</li>
              <li>The <strong>Rules</strong> tab groups short, searchable rules entries by category (movement, actions, conditions, etc.).</li>
              <li>The <strong>Spells</strong> tab lets you filter by name, class, level, school, and concentration, with quick casting details and a plain-language description.</li>
              <li>Nothing is pulled from any paid rulebook; these are summaries you can pair with your own notes.</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="accordion-item bg-dark text-light border-secondary">
        <h2 class="accordion-header">
          <button class="accordion-button collapsed bg-dark text-light" type="button" data-bs-toggle="collapse" data-bs-target="#helpShortcuts">
            Keyboard Shortcuts
          </button>
        </h2>
        <div id="helpShortcuts" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
          <div class="accordion-body">
            <div class="alert alert-info text-light mb-2">
              <code>N</code> Next Turn • <code>R</code> Reset Rounds • <code>C</code> Copy Order •
              <code>S</code> Manual Save • <code>L</code> Lock Order
            </div>
            <p class="mb-0 small text-secondary">Shortcuts are disabled while typing in inputs or textareas.</p>
          </div>
        </div>
      </div>

      <div class="accordion-item bg-dark text-light border-secondary">
        <h2 class="accordion-header">
          <button class="accordion-button collapsed bg-dark text-light" type="button" data-bs-toggle="collapse" data-bs-target="#helpNotes">
            Session Notes
          </button>
        </h2>
        <div id="helpNotes" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
          <div class="accordion-body">
            <ul class="mb-0">
              <li>Use the <strong>Session Notes</strong> panel (right side) to keep general notes for the whole session.</li>
              <li>Notes auto-save locally as you type; you can also Export/Import them as plain text.</li>
              <li>Clearing Saved Data will also clear these notes, so export them first if you want a backup.</li>
            </ul>
          </div>
        </div>
      </div>

    </div><!-- /accordion -->
  </div><!-- /offcanvas-body -->
</div>



  <footer class="container-fluid mt-5 site-footer" role="contentinfo">
    <div class="footer-main py-3">
      <div class="container">
        <div class="row align-items-center text-center text-md-start">
          <!-- Left: Copyright -->
          <div class="col-12 col-md-4 mb-2 mb-md-0 text-md-start text-center">
            <small class="text-muted">&copy; 2025 Maybeme | The DM’s Toolbox</small>
          </div>

          <!-- Center: Logo -->
          <div class="col-12 col-md-4 text-center mb-2 mb-md-0">
            <img src="/images/White logo - no background.png" height="40" alt="Logo" class="footer-logo">
          </div>

          <!-- Right: Social Links -->
          <div class="col-12 col-md-4 d-flex justify-content-center justify-content-md-end align-items-center gap-2">
            <a href="https://www.linkedin.com/in/marlo-mayberry-930ab9b7/" class="socialicons" target="_blank" rel="noopener" aria-label="LinkedIn">
              <i class="bi bi-linkedin"></i>
            </a>
            <a href="https://github.com/M-ybeme" class="socialicons" target="_blank" rel="noopener" aria-label="GitHub">
              <i class="bi bi-github"></i>
            </a>
            <a href="https://ko-fi.com/maybemestoolbox" class="socialicons d-flex align-items-center" target="_blank" rel="noopener" title="Support The DM’s Toolbox on Ko-fi">
              <i class="bi bi-cup-hot"></i>
            </a>
          </div>
        </div>
      </div>
    </div>
  </footer>


  <div id="rollToast"
       class="toast position-fixed top-50 start-50 translate-middle"
       role="status" aria-live="polite" aria-atomic="true"
       data-bs-delay="900" style="z-index: 1080;">
    <div class="toast-body fs-3 fw-bold text-center"></div>
  </div>

  <div id="concToast"
       class="toast position-fixed bottom-0 start-50 translate-middle-x"
       role="dialog" aria-live="assertive" aria-atomic="true"
       data-bs-autohide="false" style="z-index:1080; min-width: 320px;">
    <div class="toast-header bg-warning text-dark">
      <strong class="me-auto">Concentration Check</strong>
      <small class="text-muted" id="concToastName"></small>
      <button type="button" class="btn-close ms-2" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body">
      <div id="concToastMsg" class="mb-2"></div>
      <div class="d-flex gap-2 justify-content-end">
        <button id="concPassBtn" class="btn btn-outline-success btn-sm">Pass</button>
        <button id="concFailBtn" class="btn btn-outline-danger btn-sm">Fail</button>
      </div>
    </div>
  </div>

  <!-- Rules / Spells Modal -->
  <div class="modal fade" id="rulesModal" tabindex="-1" aria-labelledby="rulesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen-md-down modal-xl">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 class="modal-title" id="rulesModalLabel">Rules & Spells Reference</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <ul class="nav nav-pills mb-3" id="rulesTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="rules-tab" data-bs-toggle="pill" data-bs-target="#rules-pane" type="button" role="tab">
                Rules
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="spells-tab" data-bs-toggle="pill" data-bs-target="#spells-pane" type="button" role="tab" aria-controls="spells-pane">
                Spells
              </button>
            </li>
          </ul>

          <div class="tab-content">
            <!-- RULES TAB -->
            <div class="tab-pane fade show active" id="rules-pane" role="tabpanel" aria-labelledby="rules-tab">
              <div class="row g-3">
                <!-- Sidebar -->
                <div class="col-12 col-md-4 col-lg-3">
                  <input id="rulesSearch" class="form-control form-control-sm mb-2" placeholder="Search (title, tags, text)…" />
                  <div id="rulesCategories" class="list-group small"></div>
                </div>

                <!-- Content -->
                <div class="col-12 col-md-8 col-lg-9">
                  <div id="rulesContainer" class="accordion"></div>
                  <div id="rulesEmpty" class="text-secondary small d-none">No results.</div>
                </div>
              </div>
            </div>

            <!-- SPELLS TAB (placeholder for now) -->
            <div class="tab-pane fade" id="spells-pane" role="tabpanel" aria-labelledby="spells-tab">
              <div class="alert alert-info text-dark">
                Spells tab coming next. We’ll support name/school/level filters and SRD-safe summaries, with links to your own notes.
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <div class="small text-secondary me-auto">
            Plain-language summaries. Not verbatim text from any rulebook.
          </div>
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script src="/js/rules-data.js"></script>
  <script src="/js/spells-data.js"></script>
  <script src="/js/initiative.js"></script>
</body>
</html>
