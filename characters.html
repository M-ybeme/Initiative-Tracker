<!DOCTYPE html> 
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The DM's Toolbox: Characters</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
  <!-- Custom CSS -->
  <link href="/css/site.css" rel="stylesheet" />
  <link href="/css/characters-mobile.css" rel="stylesheet" />
  <!-- Dev Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/devicons/devicon@v2.15.1/devicon.min.css" />
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/images/dndFavicon (2).png" />

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <script src="/js/site.js"></script>

  <style>
    .bgimage{
      background: url('images/BGMap.png') no-repeat center center fixed;
      background-size: cover;
    }
    .bg-orange { background-color: #fd7e14 !important; color: #212529 !important; }
    .drag-handle { cursor: move; }
    .active-turn {
      border-left: 5px solid #1d9e6d !important;
      color: #f8f9fa !important;
      font-weight: bold;
    }
    #saveHistorySelect { min-width: 200px; }

    .backdrop {
      background: rgba(0, 0, 0, 0.65);
      border-radius: 0.5rem;
      padding: 1rem;
    }

    .portrait-frame {
      overflow: hidden;
      position: relative;
      border-radius: 0.5rem;
      border: 1px solid rgba(255,255,255,0.15);
      background-color: rgba(15,15,15,0.9);
    }

    .portrait-image {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(1);
      transform-origin: center center;
      user-select: none;
      -webkit-user-drag: none;
      max-width: none;
      max-height: none;
      min-width: 100%;
      min-height: 100%;
    }

    .skill-table th,
    .skill-table td {
      padding: 0.25rem 0.4rem;
      vertical-align: middle;
    }

    .skill-table input[type="number"] {
      max-width: 3.5rem;
    }

    .save-pill {
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.2);
      padding: 0.25rem 0.6rem;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .save-pill label {
      margin-bottom: 0;
    }

    .save-pill input[type="number"] {
      max-width: 3.5rem;
    }
  </style>
</head>
<body class="bgimage">
  <!-- Nav -->
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top text-light" id="mainNav">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">
        <img src="/images/dndFavicon (2).png" height="40" width="40" alt="App Logo" class="d-inline-block" />
        The DM Toolbox
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
              aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" href="index.html">Initiative</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="name.html">Name Gen</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="loot.html">Loot Gen</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="shop.html">Shop Gen</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="npc.html">NPC Gen</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="tav.html">Tavern/Inn Gen</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="battlemap.html">Battle Map</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="encounterbuilder.html">Encounter Builder</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="characters.html">Characters</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main -->
  <main class="content pt-4">
    <div class="container-fluid mt-5 pt-3">
      <div class="container backdrop text-light">
        <!-- Header + Character Selector / Actions -->
        <div class="d-flex flex-column flex-md-row align-items-md-center mb-3 gap-3">
          <div>
            <h2 class="mb-0">Character Manager</h2>
            <small class="text-muted">DM-focused character sheets with portraits, saved locally in your browser.</small>
          </div>

          <div class="ms-md-auto w-100 w-md-auto d-flex flex-column flex-lg-row gap-2 align-items-stretch align-items-lg-center mt-3 mt-md-0">
            <div class="d-flex flex-column flex-lg-row gap-2 align-items-stretch align-items-lg-center flex-grow-1">
              <select id="characterSelect" class="form-select" aria-label="Select Character">
                <!-- Populated by JS -->
              </select>

              <div class="btn-group flex-wrap" role="group" aria-label="Character actions">
                <button type="button" class="btn btn-sm btn-outline-light" id="newCharacterBtn">
                  <i class="bi bi-person-plus me-1"></i>New
                </button>
                <button type="button" class="btn btn-sm btn-outline-light" id="saveCharacterBtn">
                  <i class="bi bi-save me-1"></i>Save
                </button>
                <button type="button" class="btn btn-sm btn-outline-light" id="deleteCharacterBtn">
                  <i class="bi bi-trash me-1"></i>Delete
                </button>
              </div>
            </div>

            <div class="d-flex flex-wrap gap-2 justify-content-start justify-content-lg-end">
              <button type="button" class="btn btn-sm btn-outline-info" id="exportCharacterBtn" title="Export current character as JSON">
                <i class="bi bi-download me-1"></i>Export
              </button>
              <button type="button" class="btn btn-sm btn-outline-warning" id="sendToTrackerBtn" title="Send current character to the Initiative Tracker">
                <i class="bi bi-arrow-right-circle me-1"></i>Send to Initiative Tracker
              </button>
              <button type="button" class="btn btn-sm btn-outline-info" id="exportAllCharactersBtn" title="Export all characters as JSON">
                <i class="bi bi-archive me-1"></i>Export All
              </button>

              <div class="position-relative">
                <input type="file" id="importFileInput" accept="application/json" class="d-none" />
                <button type="button" class="btn btn-sm btn-outline-warning" id="importCharacterBtn" title="Import character JSON">
                  <i class="bi bi-upload me-1"></i>Import
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Last updated -->
        <div class="mb-3">
          <small id="lastUpdatedText" class="text-muted"></small>
        </div>

        <!-- Main layout -->
        <div class="row g-3">
          <!-- LEFT COLUMN -->
          <div class="col-12 col-lg-8">
            <!-- Basic Identity -->
            <div class="card bg-dark border-secondary mb-3">
              <div class="card-header border-secondary">
                <strong>Basic Information</strong>
              </div>
              <div class="card-body">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="charName" class="form-label">Character Name</label>
                    <input type="text" id="charName" class="form-control form-control-sm" placeholder="Valen Khorath" />
                  </div>
                  <div class="col-md-6">
                    <label for="playerName" class="form-label">Player Name</label>
                    <input type="text" id="playerName" class="form-control form-control-sm" placeholder="Player / seat" />
                  </div>

                  <div class="col-md-4">
                    <label for="charRace" class="form-label">Race / Ancestry</label>
                    <input type="text" id="charRace" class="form-control form-control-sm" placeholder="Tiefling, Human, Owlin..." />
                  </div>
                  <div class="col-md-4">
                    <label for="charClass" class="form-label">Class / Subclass</label>
                    <input type="text" id="charClass" class="form-control form-control-sm" placeholder="Illrigger, Wizard (Evocation)..." />
                  </div>
                  <div class="col-md-2">
                    <label for="charLevel" class="form-label">Level</label>
                    <input type="number" min="1" max="20" id="charLevel" class="form-control form-control-sm" />
                  </div>
                  <div class="col-md-2">
                    <label for="charAlignment" class="form-label">Alignment</label>
                    <input type="text" id="charAlignment" class="form-control form-control-sm" placeholder="NG, LE..." />
                  </div>

                  <div class="col-md-12">
                    <label for="charRoleNotes" class="form-label">Party Role / DM Notes</label>
                    <textarea id="charRoleNotes" rows="2" class="form-control form-control-sm"
                              placeholder="Tank, face, skill monkey, spell slot battery, chaos gremlin... plus any quick reminders for you as DM."></textarea>
                  </div>
                </div>
              </div>
            </div>

            <!-- Resources & Rest -->
                         <!-- Combat Snapshot -->
            <div class="card bg-dark border-secondary mb-3">
              <div class="card-header border-secondary">
                <strong>Combat Snapshot</strong>
              </div>
              <div class="card-body">
                <div class="row g-2 mb-2">
                  <div class="col-4 col-md-2">
                    <label for="charAC" class="form-label small">AC</label>
                    <input type="number"
                           id="charAC"
                           class="form-control form-control-sm text-center"
                           min="0" />
                  </div>
                  <div class="col-4 col-md-3">
                    <label for="charMaxHP" class="form-label small">Max HP</label>
                    <input type="number"
                           id="charMaxHP"
                           class="form-control form-control-sm text-center"
                           min="0" />
                  </div>
                  <div class="col-4 col-md-3">
                    <label for="charCurrentHP" class="form-label small">Current HP</label>
                    <input type="number"
                           id="charCurrentHP"
                           class="form-control form-control-sm text-center"
                           min="0" />
                  </div>
                  <div class="col-12 col-md-4">
                    <label for="charTempHP" class="form-label small">Temp HP</label>
                    <input type="number"
                           id="charTempHP"
                           class="form-control form-control-sm text-center"
                           min="0" />
                  </div>
                </div>

                <!-- HP Adjustment Buttons -->
                <div class="row g-2 mb-2">
                  <div class="col-12">
                    <div class="btn-group w-100" role="group" aria-label="HP adjustments">
                      <button type="button" class="btn btn-sm btn-success" data-hp-adjust="heal">
                        <i class="bi bi-plus-circle"></i> Heal
                      </button>
                      <button type="button" class="btn btn-sm btn-danger" data-hp-adjust="damage">
                        <i class="bi bi-dash-circle"></i> Damage
                      </button>
                      <button type="button" class="btn btn-sm btn-info" data-hp-adjust="temp">
                        <i class="bi bi-shield-plus"></i> Temp HP
                      </button>
                      <button type="button" class="btn btn-sm btn-warning" data-hp-adjust="max">
                        <i class="bi bi-arrow-up"></i> Max
                      </button>
                    </div>
                  </div>
                </div>

                <div class="row g-2 mb-2">
                  <div class="col-6 col-md-4">
                    <label for="charSpeed" class="form-label small">Speed</label>
                    <input type="text"
                           id="charSpeed"
                           class="form-control form-control-sm"
                           placeholder="30 ft, 40 ft fly..." />
                  </div>
                  <div class="col-6 col-md-4">
                    <label for="charInitMod" class="form-label small">Initiative Mod</label>
                    <input type="number"
                           id="charInitMod"
                           class="form-control form-control-sm text-center"
                           placeholder="0" />
                  </div>
                  <div class="col-12 col-md-4">
                    <label for="charConditions" class="form-label small">Active Conditions</label>
                    <input type="text"
                           id="charConditions"
                           class="form-control form-control-sm"
                           placeholder="Blessed, Hexed, etc." />
                  </div>
                </div>

                <!-- Inspiration & Concentration -->
                <div class="row g-2">
                  <div class="col-6 col-md-4">
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" id="charInspiration" />
                      <label class="form-check-label small" for="charInspiration">
                        <i class="bi bi-star-fill text-warning"></i> Inspiration
                      </label>
                    </div>
                  </div>
                  <div class="col-6 col-md-8">
                    <div class="d-flex align-items-center gap-2">
                      <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="charConcentrating" />
                        <label class="form-check-label small" for="charConcentrating">
                          <i class="bi bi-lightning-fill text-info"></i> Concentrating
                        </label>
                      </div>
                      <input type="text"
                             id="charConcentrationSpell"
                             class="form-control form-control-sm"
                             placeholder="Spell name"
                             style="max-width: 150px;" />
                    </div>
                  </div>
                </div>

                <!-- Condition Toggles -->
                <div class="mt-3">
                  <label class="form-label small">Quick Conditions</label>
                  <div class="d-flex flex-wrap gap-1" id="conditionToggles">
                    <!-- Common D&D 5e conditions -->
                    <button type="button" class="btn btn-sm btn-outline-secondary condition-btn" data-condition="Blinded">Blinded</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary condition-btn" data-condition="Charmed">Charmed</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary condition-btn" data-condition="Deafened">Deafened</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary condition-btn" data-condition="Frightened">Frightened</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary condition-btn" data-condition="Grappled">Grappled</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary condition-btn" data-condition="Incapacitated">Incapacitated</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary condition-btn" data-condition="Invisible">Invisible</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary condition-btn" data-condition="Paralyzed">Paralyzed</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary condition-btn" data-condition="Petrified">Petrified</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary condition-btn" data-condition="Poisoned">Poisoned</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary condition-btn" data-condition="Prone">Prone</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary condition-btn" data-condition="Restrained">Restrained</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary condition-btn" data-condition="Stunned">Stunned</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary condition-btn" data-condition="Unconscious">Unconscious</button>
                    <button type="button" class="btn btn-sm btn-outline-info condition-btn" data-condition="Concentrating">Concentrating</button>
                    <button type="button" class="btn btn-sm btn-outline-success condition-btn" data-condition="Blessed">Blessed</button>
                    <button type="button" class="btn btn-sm btn-outline-warning condition-btn" data-condition="Hexed">Hexed</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Currency -->
            <div class="card bg-dark border-secondary mb-3">
              <div class="card-header border-secondary">
                <strong>Currency</strong>
              </div>
              <div class="card-body">
                <div class="row g-2">
                  <div class="col">
                    <label for="currencyCP" class="form-label small">CP</label>
                    <input type="number" id="currencyCP" class="form-control form-control-sm text-center" min="0" placeholder="0" />
                  </div>
                  <div class="col">
                    <label for="currencySP" class="form-label small">SP</label>
                    <input type="number" id="currencySP" class="form-control form-control-sm text-center" min="0" placeholder="0" />
                  </div>
                  <div class="col">
                    <label for="currencyEP" class="form-label small">EP</label>
                    <input type="number" id="currencyEP" class="form-control form-control-sm text-center" min="0" placeholder="0" />
                  </div>
                  <div class="col">
                    <label for="currencyGP" class="form-label small">GP</label>
                    <input type="number" id="currencyGP" class="form-control form-control-sm text-center" min="0" placeholder="0" />
                  </div>
                  <div class="col">
                    <label for="currencyPP" class="form-label small">PP</label>
                    <input type="number" id="currencyPP" class="form-control form-control-sm text-center" min="0" placeholder="0" />
                  </div>
                </div>
              </div>
            </div>

            <!-- Death Saves & Exhaustion -->
            <div class="card bg-dark border-secondary mb-3">
              <div class="card-header border-secondary">
                <strong>Death Saves & Exhaustion</strong>
              </div>
              <div class="card-body">
                <div class="row g-3">
                  <div class="col-12 col-md-6">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <label class="form-label small mb-0">Death Saves</label>
                      <button type="button" class="btn btn-sm btn-danger" id="rollDeathSaveBtn">
                        <i class="bi bi-dice-5"></i> Roll Death Save
                      </button>
                    </div>
                    <div class="d-flex flex-column gap-2">
                      <div class="d-flex align-items-center gap-2">
                        <span class="text-success small" style="min-width: 70px;">Successes:</span>
                        <div class="form-check form-check-inline mb-0">
                          <input class="form-check-input" type="checkbox" id="deathSaveSuccess1" />
                        </div>
                        <div class="form-check form-check-inline mb-0">
                          <input class="form-check-input" type="checkbox" id="deathSaveSuccess2" />
                        </div>
                        <div class="form-check form-check-inline mb-0">
                          <input class="form-check-input" type="checkbox" id="deathSaveSuccess3" />
                        </div>
                      </div>
                      <div class="d-flex align-items-center gap-2">
                        <span class="text-danger small" style="min-width: 70px;">Failures:</span>
                        <div class="form-check form-check-inline mb-0">
                          <input class="form-check-input" type="checkbox" id="deathSaveFailure1" />
                        </div>
                        <div class="form-check form-check-inline mb-0">
                          <input class="form-check-input" type="checkbox" id="deathSaveFailure2" />
                        </div>
                        <div class="form-check form-check-inline mb-0">
                          <input class="form-check-input" type="checkbox" id="deathSaveFailure3" />
                        </div>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="deathSaveStable" />
                        <label class="form-check-label small" for="deathSaveStable">Stable</label>
                      </div>
                    </div>
                  </div>
                  <div class="col-12 col-md-6">
                    <label for="exhaustionLevel" class="form-label small">Exhaustion Level</label>
                    <input type="number" id="exhaustionLevel" class="form-control form-control-sm" min="0" max="10" placeholder="0" />
                    <small class="text-muted d-block mt-1">
                      <span id="exhaustionDescription">0 = No exhaustion</span>
                    </small>
                  </div>
                </div>
              </div>
            </div>

            <div class="card bg-dark border-secondary mb-3" id="section-resources">
              <div class="card-header border-secondary d-flex justify-content-between align-items-center">
                <strong>Resources &amp; Rests</strong>
                <div class="btn-group btn-group-sm" role="group" aria-label="Rest controls">
                  <button type="button" class="btn btn-outline-light" id="shortRestBtn">Short Rest</button>
                  <button type="button" class="btn btn-outline-success" id="longRestBtn">Long Rest</button>
                </div>
              </div>
              <div class="card-body">
                <div class="row g-2 mb-3">
                  <div class="col-6">
                    <label for="charHitDice" class="form-label small">Hit Dice</label>
                    <input type="text"
                           id="charHitDice"
                           class="form-control form-control-sm"
                           placeholder="e.g. 5d10" />
                  </div>
                  <div class="col-6">
                    <label for="charHitDiceRemaining" class="form-label small">Hit Dice Remaining</label>
                    <input type="text"
                           id="charHitDiceRemaining"
                           class="form-control form-control-sm"
                           placeholder="e.g. 3d10" />
                  </div>
                </div>
              
                <label class="form-label small">Tracked Resources</label>
                <div class="small text-muted mb-1">
                  Use for rages, ki points, superiority dice, Channel Divinity, etc.
                </div>
              
                <!-- Three generic resource rows -->
                <div class="mb-2">
                  <div class="row g-1 align-items-center mb-1">
                    <div class="col-6">
                      <input type="text"
                             id="res1Name"
                             class="form-control form-control-sm"
                             placeholder="Resource name" />
                    </div>
                    <div class="col-3">
                      <input type="number"
                             id="res1Current"
                             class="form-control form-control-sm text-center"
                             placeholder="Now" />
                    </div>
                    <div class="col-3">
                      <input type="number"
                             id="res1Max"
                             class="form-control form-control-sm text-center"
                             placeholder="Max" />
                    </div>
                  </div>
                </div>
              
                <div class="mb-2">
                  <div class="row g-1 align-items-center mb-1">
                    <div class="col-6">
                      <input type="text"
                             id="res2Name"
                             class="form-control form-control-sm"
                             placeholder="Resource name" />
                    </div>
                    <div class="col-3">
                      <input type="number"
                             id="res2Current"
                             class="form-control form-control-sm text-center"
                             placeholder="Now" />
                    </div>
                    <div class="col-3">
                      <input type="number"
                             id="res2Max"
                             class="form-control form-control-sm text-center"
                             placeholder="Max" />
                    </div>
                  </div>
                </div>
              
                <div class="mb-2">
                  <div class="row g-1 align-items-center mb-1">
                    <div class="col-6">
                      <input type="text"
                             id="res3Name"
                             class="form-control form-control-sm"
                             placeholder="Resource name" />
                    </div>
                    <div class="col-3">
                      <input type="number"
                             id="res3Current"
                             class="form-control form-control-sm text-center"
                             placeholder="Now" />
                    </div>
                    <div class="col-3">
                      <input type="number"
                             id="res3Max"
                             class="form-control form-control-sm text-center"
                             placeholder="Max" />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Ability Scores + Modifiers -->
            <div class="card bg-dark border-secondary mb-3">
              <div class="card-header border-secondary">
                <strong>Ability Scores & Modifiers</strong>
              </div>
              <div class="card-body">
                <div class="row g-3 text-center">
                  <!-- STR -->
                  <div class="col-6 col-md-2">
                    <label for="statStr" class="form-label">STR</label>
                    <input type="number"
                           id="statStr"
                           class="form-control form-control-sm text-center mb-1"
                           placeholder="Score" />
                    <input type="number"
                           id="modStr"
                           class="form-control form-control-sm text-center"
                           placeholder="Auto"
                           readonly />
                  </div>
                  <!-- DEX -->
                  <div class="col-6 col-md-2">
                    <label for="statDex" class="form-label">DEX</label>
                    <input type="number"
                           id="statDex"
                           class="form-control form-control-sm text-center mb-1"
                           placeholder="Score" />
                    <input type="number"
                           id="modDex"
                           class="form-control form-control-sm text-center"
                           placeholder="Auto"
                           readonly />
                  </div>
                  <!-- CON -->
                  <div class="col-6 col-md-2">
                    <label for="statCon" class="form-label">CON</label>
                    <input type="number"
                           id="statCon"
                           class="form-control form-control-sm text-center mb-1"
                           placeholder="Score" />
                    <input type="number"
                           id="modCon"
                           class="form-control form-control-sm text-center"
                           placeholder="Auto"
                           readonly />
                  </div>
                  <!-- INT -->
                  <div class="col-6 col-md-2">
                    <label for="statInt" class="form-label">INT</label>
                    <input type="number"
                           id="statInt"
                           class="form-control form-control-sm text-center mb-1"
                           placeholder="Score" />
                    <input type="number"
                           id="modInt"
                           class="form-control form-control-sm text-center"
                           placeholder="Auto"
                           readonly />
                  </div>
                  <!-- WIS -->
                  <div class="col-6 col-md-2">
                    <label for="statWis" class="form-label">WIS</label>
                    <input type="number"
                           id="statWis"
                           class="form-control form-control-sm text-center mb-1"
                           placeholder="Score" />
                    <input type="number"
                           id="modWis"
                           class="form-control form-control-sm text-center"
                           placeholder="Auto"
                           readonly />
                  </div>
                  <!-- CHA -->
                  <div class="col-6 col-md-2">
                    <label for="statCha" class="form-label">CHA</label>
                    <input type="number"
                           id="statCha"
                           class="form-control form-control-sm text-center mb-1"
                           placeholder="Score" />
                    <input type="number"
                           id="modCha"
                           class="form-control form-control-sm text-center"
                           placeholder="Auto"
                           readonly />
                  </div>
                </div>
              </div>
            </div>

            <!-- Saving Throws -->
            <div class="card bg-dark border-secondary mb-3">
              <div class="card-header border-secondary d-flex justify-content-between align-items-center">
                <strong>Saving Throws</strong>
                <small class="text-muted">Shift+Click = Advantage, Ctrl+Click = Disadvantage</small>
              </div>
              <div class="card-body">
                <div class="row g-2">
                  <!-- STR save -->
                  <div class="col-6 col-md-4 col-lg-2">
                    <div class="save-pill">
                      <div class="form-check mb-0">
                        <input class="form-check-input" type="checkbox" id="saveStrProf" />
                      </div>
                      <label for="saveStrBonus" class="fw-bold small">STR</label>
                      <input type="number" id="saveStrBonus" class="form-control form-control-sm text-center" placeholder="0" />
                      <button type="button" class="btn btn-sm btn-outline-light p-0 px-1" data-save-roll="str" title="Roll STR save">
                        <i class="bi bi-dice-5"></i>
                      </button>
                    </div>
                  </div>
                  <!-- DEX save -->
                  <div class="col-6 col-md-4 col-lg-2">
                    <div class="save-pill">
                      <div class="form-check mb-0">
                        <input class="form-check-input" type="checkbox" id="saveDexProf" />
                      </div>
                      <label for="saveDexBonus" class="fw-bold small">DEX</label>
                      <input type="number" id="saveDexBonus" class="form-control form-control-sm text-center" placeholder="0" />
                      <button type="button" class="btn btn-sm btn-outline-light p-0 px-1" data-save-roll="dex" title="Roll DEX save">
                        <i class="bi bi-dice-5"></i>
                      </button>
                    </div>
                  </div>
                  <!-- CON save -->
                  <div class="col-6 col-md-4 col-lg-2">
                    <div class="save-pill">
                      <div class="form-check mb-0">
                        <input class="form-check-input" type="checkbox" id="saveConProf" />
                      </div>
                      <label for="saveConBonus" class="fw-bold small">CON</label>
                      <input type="number" id="saveConBonus" class="form-control form-control-sm text-center" placeholder="0" />
                      <button type="button" class="btn btn-sm btn-outline-light p-0 px-1" data-save-roll="con" title="Roll CON save">
                        <i class="bi bi-dice-5"></i>
                      </button>
                    </div>
                  </div>
                  <!-- INT save -->
                  <div class="col-6 col-md-4 col-lg-2">
                    <div class="save-pill">
                      <div class="form-check mb-0">
                        <input class="form-check-input" type="checkbox" id="saveIntProf" />
                      </div>
                      <label for="saveIntBonus" class="fw-bold small">INT</label>
                      <input type="number" id="saveIntBonus" class="form-control form-control-sm text-center" placeholder="0" />
                      <button type="button" class="btn btn-sm btn-outline-light p-0 px-1" data-save-roll="int" title="Roll INT save">
                        <i class="bi bi-dice-5"></i>
                      </button>
                    </div>
                  </div>
                  <!-- WIS save -->
                  <div class="col-6 col-md-4 col-lg-2">
                    <div class="save-pill">
                      <div class="form-check mb-0">
                        <input class="form-check-input" type="checkbox" id="saveWisProf" />
                      </div>
                      <label for="saveWisBonus" class="fw-bold small">WIS</label>
                      <input type="number" id="saveWisBonus" class="form-control form-control-sm text-center" placeholder="0" />
                      <button type="button" class="btn btn-sm btn-outline-light p-0 px-1" data-save-roll="wis" title="Roll WIS save">
                        <i class="bi bi-dice-5"></i>
                      </button>
                    </div>
                  </div>
                  <!-- CHA save -->
                  <div class="col-6 col-md-4 col-lg-2">
                    <div class="save-pill">
                      <div class="form-check mb-0">
                        <input class="form-check-input" type="checkbox" id="saveChaProf" />
                      </div>
                      <label for="saveChaBonus" class="fw-bold small">CHA</label>
                      <input type="number" id="saveChaBonus" class="form-control form-control-sm text-center" placeholder="0" />
                      <button type="button" class="btn btn-sm btn-outline-light p-0 px-1" data-save-roll="cha" title="Roll CHA save">
                        <i class="bi bi-dice-5"></i>
                      </button>
                    </div>
                  </div>
                </div>

                <div class="mt-3">
                  <label for="saveNotes" class="form-label">Saving Throw Notes</label>
                  <textarea id="saveNotes" rows="2" class="form-control form-control-sm"
                            placeholder="e.g. Advantage vs frightened, resistance to fire, etc."></textarea>
                </div>
              </div>
            </div>

            <!-- Skills -->
            <div class="card bg-dark border-secondary mb-3">
              <div class="card-header border-secondary d-flex justify-content-between align-items-center">
                <strong>Skills</strong>
                <small class="text-muted">Exp = Expertise (Ã—2 Prof) | Shift/Ctrl for Adv/Dis</small>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-sm table-dark table-striped align-middle mb-2 skill-table">
                    <thead>
                      <tr class="text-muted small">
                        <th scope="col" style="width:2rem;">Prof</th>
                        <th scope="col" style="width:2rem;">Exp</th>
                        <th scope="col" style="width:3rem;">Mod</th>
                        <th scope="col">Skill</th>
                        <th scope="col" style="width:4rem;" class="text-center">Bonus</th>
                        <th scope="col" style="width:3rem;"></th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillAcrobaticsProf" class="form-check-input" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" id="skillAcrobaticsExp" class="form-check-input" title="Expertise (double proficiency)" />
                        </td>
                        <td>DEX</td>
                        <td>Acr<span class="d-none d-md-inline">obatics</span></td>
                        <td class="text-center">
                          <input type="number" id="skillAcrobaticsBonus" class="form-control form-control-sm text-center" />
                        </td>
                        <td class="text-center">
                          <button type="button" class="btn btn-sm btn-outline-light" data-skill-roll="acrobatics" title="Roll Acrobatics">
                            <i class="bi bi-dice-5"></i>
                          </button>
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillAnimalHandlingProf" class="form-check-input" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" id="skillAnimalHandlingExp" class="form-check-input" title="Expertise (double proficiency)" />
                        </td>
                        <td>WIS</td>
                        <td>Animal Handling</td>
                        <td class="text-center">
                          <input type="number" id="skillAnimalHandlingBonus" class="form-control form-control-sm text-center" />
                        </td>
                        <td class="text-center">
                          <button type="button" class="btn btn-sm btn-outline-light" data-skill-roll="animalHandling" title="Roll Animal Handling">
                            <i class="bi bi-dice-5"></i>
                          </button>
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillArcanaProf" class="form-check-input" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" id="skillArcanaExp" class="form-check-input" title="Expertise (double proficiency)" />
                        </td>
                        <td>INT</td>
                        <td>Arcana</td>
                        <td class="text-center">
                          <input type="number" id="skillArcanaBonus" class="form-control form-control-sm text-center" />
                        </td>
                        <td class="text-center">
                          <button type="button" class="btn btn-sm btn-outline-light" data-skill-roll="arcana" title="Roll Arcana">
                            <i class="bi bi-dice-5"></i>
                          </button>
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillAthleticsProf" class="form-check-input" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" id="skillAthleticsExp" class="form-check-input" title="Expertise (double proficiency)" />
                        </td>
                        <td>STR</td>
                        <td>Athletics</td>
                        <td class="text-center">
                          <input type="number" id="skillAthleticsBonus" class="form-control form-control-sm text-center" />
                        </td>
                        <td class="text-center">
                          <button type="button" class="btn btn-sm btn-outline-light" data-skill-roll="athletics" title="Roll Athletics">
                            <i class="bi bi-dice-5"></i>
                          </button>
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillDeceptionProf" class="form-check-input" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" id="skillDeceptionExp" class="form-check-input" title="Expertise (double proficiency)" />
                        </td>
                        <td>CHA</td>
                        <td>Deception</td>
                        <td class="text-center">
                          <input type="number" id="skillDeceptionBonus" class="form-control form-control-sm text-center" />
                        </td>
                        <td class="text-center">
                          <button type="button" class="btn btn-sm btn-outline-light" data-skill-roll="deception" title="Roll Deception">
                            <i class="bi bi-dice-5"></i>
                          </button>
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillHistoryProf" class="form-check-input" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" id="skillHistoryExp" class="form-check-input" title="Expertise (double proficiency)" />
                        </td>
                        <td>INT</td>
                        <td>History</td>
                        <td class="text-center">
                          <input type="number" id="skillHistoryBonus" class="form-control form-control-sm text-center" />
                        </td>
                        <td class="text-center">
                          <button type="button" class="btn btn-sm btn-outline-light" data-skill-roll="history" title="Roll History">
                            <i class="bi bi-dice-5"></i>
                          </button>
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillInsightProf" class="form-check-input" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" id="skillInsightExp" class="form-check-input" title="Expertise (double proficiency)" />
                        </td>
                        <td>WIS</td>
                        <td>Insight</td>
                        <td class="text-center">
                          <input type="number" id="skillInsightBonus" class="form-control form-control-sm text-center" />
                        </td>
                        <td class="text-center">
                          <button type="button" class="btn btn-sm btn-outline-light" data-skill-roll="insight" title="Roll Insight">
                            <i class="bi bi-dice-5"></i>
                          </button>
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillIntimidationProf" class="form-check-input" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" id="skillIntimidationExp" class="form-check-input" title="Expertise (double proficiency)" />
                        </td>
                        <td>CHA</td>
                        <td>Intimidation</td>
                        <td class="text-center">
                          <input type="number" id="skillIntimidationBonus" class="form-control form-control-sm text-center" />
                        </td>
                        <td class="text-center">
                          <button type="button" class="btn btn-sm btn-outline-light" data-skill-roll="intimidation" title="Roll Intimidation">
                            <i class="bi bi-dice-5"></i>
                          </button>
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillInvestigationProf" class="form-check-input" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" id="skillInvestigationExp" class="form-check-input" title="Expertise (double proficiency)" />
                        </td>
                        <td>INT</td>
                        <td>Investigation</td>
                        <td class="text-center">
                          <input type="number" id="skillInvestigationBonus" class="form-control form-control-sm text-center" />
                        </td>
                        <td class="text-center">
                          <button type="button" class="btn btn-sm btn-outline-light" data-skill-roll="investigation" title="Roll Investigation">
                            <i class="bi bi-dice-5"></i>
                          </button>
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillMedicineProf" class="form-check-input" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" id="skillMedicineExp" class="form-check-input" title="Expertise (double proficiency)" />
                        </td>
                        <td>WIS</td>
                        <td>Medicine</td>
                        <td class="text-center">
                          <input type="number" id="skillMedicineBonus" class="form-control form-control-sm text-center" />
                        </td>
                        <td class="text-center">
                          <button type="button" class="btn btn-sm btn-outline-light" data-skill-roll="medicine" title="Roll Medicine">
                            <i class="bi bi-dice-5"></i>
                          </button>
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillNatureProf" class="form-check-input" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" id="skillNatureExp" class="form-check-input" title="Expertise (double proficiency)" />
                        </td>
                        <td>INT</td>
                        <td>Nature</td>
                        <td class="text-center">
                          <input type="number" id="skillNatureBonus" class="form-control form-control-sm text-center" />
                        </td>
                        <td class="text-center">
                          <button type="button" class="btn btn-sm btn-outline-light" data-skill-roll="nature" title="Roll Nature">
                            <i class="bi bi-dice-5"></i>
                          </button>
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillPerceptionProf" class="form-check-input" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" id="skillPerceptionExp" class="form-check-input" title="Expertise (double proficiency)" />
                        </td>
                        <td>WIS</td>
                        <td>Perception</td>
                        <td class="text-center">
                          <input type="number" id="skillPerceptionBonus" class="form-control form-control-sm text-center" />
                        </td>
                        <td class="text-center">
                          <button type="button" class="btn btn-sm btn-outline-light" data-skill-roll="perception" title="Roll Perception">
                            <i class="bi bi-dice-5"></i>
                          </button>
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillPerformanceProf" class="form-check-input" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" id="skillPerformanceExp" class="form-check-input" title="Expertise (double proficiency)" />
                        </td>
                        <td>CHA</td>
                        <td>Performance</td>
                        <td class="text-center">
                          <input type="number" id="skillPerformanceBonus" class="form-control form-control-sm text-center" />
                        </td>
                        <td class="text-center">
                          <button type="button" class="btn btn-sm btn-outline-light" data-skill-roll="performance" title="Roll Performance">
                            <i class="bi bi-dice-5"></i>
                          </button>
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillPersuasionProf" class="form-check-input" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" id="skillPersuasionExp" class="form-check-input" title="Expertise (double proficiency)" />
                        </td>
                        <td>CHA</td>
                        <td>Persuasion</td>
                        <td class="text-center">
                          <input type="number" id="skillPersuasionBonus" class="form-control form-control-sm text-center" />
                        </td>
                        <td class="text-center">
                          <button type="button" class="btn btn-sm btn-outline-light" data-skill-roll="persuasion" title="Roll Persuasion">
                            <i class="bi bi-dice-5"></i>
                          </button>
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillReligionProf" class="form-check-input" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" id="skillReligionExp" class="form-check-input" title="Expertise (double proficiency)" />
                        </td>
                        <td>INT</td>
                        <td>Religion</td>
                        <td class="text-center">
                          <input type="number" id="skillReligionBonus" class="form-control form-control-sm text-center" />
                        </td>
                        <td class="text-center">
                          <button type="button" class="btn btn-sm btn-outline-light" data-skill-roll="religion" title="Roll Religion">
                            <i class="bi bi-dice-5"></i>
                          </button>
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillSleightOfHandProf" class="form-check-input" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" id="skillSleightOfHandExp" class="form-check-input" title="Expertise (double proficiency)" />
                        </td>
                        <td>DEX</td>
                        <td>Sleight of Hand</td>
                        <td class="text-center">
                          <input type="number" id="skillSleightOfHandBonus" class="form-control form-control-sm text-center" />
                        </td>
                        <td class="text-center">
                          <button type="button" class="btn btn-sm btn-outline-light" data-skill-roll="sleightOfHand" title="Roll Sleight of Hand">
                            <i class="bi bi-dice-5"></i>
                          </button>
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillStealthProf" class="form-check-input" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" id="skillStealthExp" class="form-check-input" title="Expertise (double proficiency)" />
                        </td>
                        <td>DEX</td>
                        <td>Stealth</td>
                        <td class="text-center">
                          <input type="number" id="skillStealthBonus" class="form-control form-control-sm text-center" />
                        </td>
                        <td class="text-center">
                          <button type="button" class="btn btn-sm btn-outline-light" data-skill-roll="stealth" title="Roll Stealth">
                            <i class="bi bi-dice-5"></i>
                          </button>
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillSurvivalProf" class="form-check-input" />
                        </td>
                        <td class="text-center">
                          <input type="checkbox" id="skillSurvivalExp" class="form-check-input" title="Expertise (double proficiency)" />
                        </td>
                        <td>WIS</td>
                        <td>Survival</td>
                        <td class="text-center">
                          <input type="number" id="skillSurvivalBonus" class="form-control form-control-sm text-center" />
                        </td>
                        <td class="text-center">
                          <button type="button" class="btn btn-sm btn-outline-light" data-skill-roll="survival" title="Roll Survival">
                            <i class="bi bi-dice-5"></i>
                          </button>
                        </td>
                      </tr>

                    </tbody>
                  </table>
                </div>
                <label for="skillsNotes" class="form-label">Additional Skills / Expertise Notes</label>
                <textarea id="skillsNotes" rows="2" class="form-control form-control-sm"
                          placeholder="Expertise, jack-of-all-trades, custom skills, etc."></textarea>
              </div>
            </div>
          </div>

          <!-- RIGHT COLUMN -->
          <div class="col-12 col-lg-4">
            <!-- Roll History Panel (Sticky) -->
            <div class="card bg-dark border-secondary mb-3 sticky-top" id="rollHistoryPanel" style="top: 70px;">
              <div class="card-header border-secondary d-flex justify-content-between align-items-center" id="rollHistoryHeader" style="cursor: pointer;">
                <strong><i class="bi bi-dice-5 me-1"></i>Roll History</strong>
                <div>
                  <button type="button" class="btn btn-sm btn-outline-danger" id="clearHistoryBtn">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </div>
              <div class="card-body p-0" style="max-height: 400px; overflow-y: auto;">
                <div id="rollHistoryList">
                  <!-- Populated by JS -->
                </div>
              </div>
            </div>

            <!-- Portrait (preview only, edits via modal) -->
            <div class="card bg-dark border-secondary mb-3">
              <div class="card-header border-secondary d-flex justify-content-between align-items-center">
                <strong>Character Portrait</strong>
              </div>
              <div class="card-body">
                <div id="portraitContainer"
                     class="portrait-frame mb-3"
                     style="height: 320px;">
                  <img id="portraitPreview"
                       class="portrait-image d-none"
                       alt="Character portrait preview" />
                  <span id="portraitPlaceholderText" class="text-muted position-absolute top-50 start-50 translate-middle text-center">
                    No portrait selected
                  </span>
                </div>

                <div class="mb-2">
                  <label for="portraitFile" class="form-label">Upload Portrait Image</label>
                  <input type="file" id="portraitFile" class="form-control form-control-sm" accept="image/*" />
                  <small class="text-muted">Stored as base64 in your browserâ€™s local storage.</small>
                </div>

                <div class="mb-2">
                  <label for="portraitUrl" class="form-label">Or Use Image URL</label>
                  <div class="input-group input-group-sm">
                    <span class="input-group-text"><i class="bi bi-link-45deg"></i></span>
                    <input type="url" id="portraitUrl" class="form-control" placeholder="https://example.com/image.png" />
                    <button class="btn btn-outline-light" type="button" id="applyPortraitUrlBtn">Use URL</button>
                  </div>
                </div>

                <div class="d-flex flex-wrap gap-2 mt-2">
                  <button type="button" class="btn btn-sm btn-outline-light" id="editPortraitBtn">
                    <i class="bi bi-crop me-1"></i>Edit Portrait Framing
                  </button>
                  <button type="button" class="btn btn-sm btn-outline-danger ms-auto" id="clearPortraitBtn">
                    <i class="bi bi-x-circle me-1"></i>Clear Portrait
                  </button>
                </div>
              </div>
            </div>

            <!-- Senses -->
            <div class="card bg-dark border-secondary mb-3" id="section-extras">
              <div class="card-header border-secondary d-flex justify-content-between align-items-center">
                <strong>Senses</strong>
                <div class="small text-muted">
                  Prof. Bonus: <span id="charProficiencyBonusDisplay">+2</span>
                </div>
              </div>
              <div class="card-body">
                <div class="row g-3">
                  <div class="col-4">
                    <label for="charPassivePerception" class="form-label small">Passive Perception</label>
                    <input type="number"
                           id="charPassivePerception"
                           class="form-control form-control-sm text-center"
                           placeholder="Auto"
                           readonly />
                  </div>
                  <div class="col-4">
                    <label for="charPassiveInvestigation" class="form-label small">Passive Investigation</label>
                    <input type="number"
                           id="charPassiveInvestigation"
                           class="form-control form-control-sm text-center" />
                  </div>
                  <div class="col-4">
                    <label for="charPassiveInsight" class="form-label small">Passive Insight</label>
                    <input type="number"
                           id="charPassiveInsight"
                           class="form-control form-control-sm text-center" />
                  </div>
                
                  <div class="col-12">
                    <label for="sensesNotes" class="form-label">Additional Sense Types</label>
                    <textarea id="sensesNotes" rows="2" class="form-control form-control-sm"
                              placeholder="Darkvision, tremorsense, blindsight, truesight, special perception rules, etc."></textarea>
                  </div>
                </div>
              </div>
            </div>

            <!-- Detailed Notes with DDB-style tabs -->
            <div class="card bg-dark border-secondary mb-3" id="section-notes">
              <div class="card-header border-secondary">
                <strong>Detailed Notes</strong>
              </div>
              <div class="card-body">
                <!-- Tabs for this block -->
                <ul class="nav nav-tabs small mb-3" id="detailTabs" role="tablist">
                  <li class="nav-item" role="presentation">
                    <button class="nav-link active"
                            id="detail-actions-tab"
                            data-bs-toggle="tab"
                            data-bs-target="#detail-actions-pane"
                            type="button"
                            role="tab"
                            aria-controls="detail-actions-pane"
                            aria-selected="true">
                      Action Notes
                    </button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link"
                            id="detail-spells-tab"
                            data-bs-toggle="tab"
                            data-bs-target="#detail-spells-pane"
                            type="button"
                            role="tab"
                            aria-controls="detail-spells-pane"
                            aria-selected="false">
                      Spells
                    </button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link"
                            id="detail-inventory-tab"
                            data-bs-toggle="tab"
                            data-bs-target="#detail-inventory-pane"
                            type="button"
                            role="tab"
                            aria-controls="detail-inventory-pane"
                            aria-selected="false">
                      Inventory
                    </button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link"
                            id="detail-features-tab"
                            data-bs-toggle="tab"
                            data-bs-target="#detail-features-pane"
                            type="button"
                            role="tab"
                            aria-controls="detail-features-pane"
                            aria-selected="false">
                      Features &amp; Traits
                    </button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link"
                            id="detail-background-tab"
                            data-bs-toggle="tab"
                            data-bs-target="#detail-background-pane"
                            type="button"
                            role="tab"
                            aria-controls="detail-background-pane"
                            aria-selected="false">
                      Background
                    </button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link"
                            id="detail-notes-tab"
                            data-bs-toggle="tab"
                            data-bs-target="#detail-notes-pane"
                            type="button"
                            role="tab"
                            aria-controls="detail-notes-pane"
                            aria-selected="false">
                      Notes
                    </button>
                  </li>
                </ul>

                <div class="tab-content">
                  <!-- Action Notes -->
                  <div class="tab-pane fade show active"
                       id="detail-actions-pane"
                       role="tabpanel"
                       aria-labelledby="detail-actions-tab">

                    <!-- Attacks Section -->
                    <div class="mb-3">
                      <div class="d-flex justify-content-between align-items-center mb-2">
                        <label class="form-label mb-0 fw-bold">Attacks & Actions</label>
                        <button type="button" class="btn btn-sm btn-success" id="addAttackBtn">
                          <i class="bi bi-plus-circle me-1"></i>Add Attack
                        </button>
                      </div>
                      <div id="attacksList" class="list-group list-group-flush small">
                        <!-- Populated by JS -->
                      </div>
                    </div>

                    <hr class="border-secondary my-3" />

                    <label for="charTableNotes" class="form-label">At-the-Table Reminders</label>
                    <textarea id="charTableNotes" rows="4" class="form-control form-control-sm"
                              placeholder="Short, brutal notes: what they want right now, likely actions, roleplay voice, conflicts, etc."></textarea>
                  </div>

                  <!-- Spells -->
                  <div class="tab-pane fade"
                       id="detail-spells-pane"
                       role="tabpanel"
                       aria-labelledby="detail-spells-tab">
                    <div class="mb-2" id="section-spells">
                      <label class="form-label">Spells / Resources</label>

                      <!-- Inner Spells Tabs -->
                      <ul class="nav nav-tabs small" id="spellsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                          <button class="nav-link active"
                                  id="spells-notes-tab"
                                  data-bs-toggle="tab"
                                  data-bs-target="#spells-notes-pane"
                                  type="button"
                                  role="tab"
                                  aria-controls="spells-notes-pane"
                                  aria-selected="true">
                            Notes
                          </button>
                        </li>
                        <li class="nav-item" role="presentation">
                          <button class="nav-link"
                                  id="spells-list-tab"
                                  data-bs-toggle="tab"
                                  data-bs-target="#spells-list-pane"
                                  type="button"
                                  role="tab"
                                  aria-controls="spells-list-pane"
                                  aria-selected="false">
                            Spell List
                          </button>
                        </li>
                      </ul>
                  
                      <div class="tab-content border border-secondary border-top-0 rounded-bottom p-2 bg-black bg-opacity-25">
                        <!-- Notes tab (freeform field) -->
                        <div class="tab-pane fade show active"
                             id="spells-notes-pane"
                             role="tabpanel"
                             aria-labelledby="spells-notes-tab">
                          <textarea id="charSpells" rows="4" class="form-control form-control-sm"
                                    placeholder="Signature spells, pact slots, channel divinity, rage uses, ki, etc."></textarea>
                        </div>
                    
                        <!-- Spell List tab -->
                        <div class="tab-pane fade"
                           id="spells-list-pane"
                           role="tabpanel"
                           aria-labelledby="spells-list-tab">

                        <!-- Spellcasting Ability & Derived Stats -->
                        <div class="mb-3 p-2 border border-secondary rounded bg-dark bg-opacity-50">
                          <div class="row g-2 align-items-end">
                            <div class="col-12 col-md-4">
                              <label for="spellcastingAbility" class="form-label small mb-1">Spellcasting Ability</label>
                              <select id="spellcastingAbility" class="form-select form-select-sm">
                                <option value="">None</option>
                                <option value="int">Intelligence</option>
                                <option value="wis">Wisdom</option>
                                <option value="cha">Charisma</option>
                              </select>
                            </div>
                            <div class="col-6 col-md-4">
                              <label class="form-label small mb-1">Spell Save DC</label>
                              <div class="form-control form-control-sm text-center bg-secondary bg-opacity-25" id="spellSaveDC">â€”</div>
                            </div>
                            <div class="col-6 col-md-4">
                              <label class="form-label small mb-1">Spell Attack Bonus</label>
                              <div class="form-control form-control-sm text-center bg-secondary bg-opacity-25" id="spellAttackBonus">â€”</div>
                            </div>
                          </div>
                        </div>

                        <!-- NEW: Spell Slots + Pact Slots -->
                        <div class="mb-3">
                          <label class="form-label small">Spell Slots</label>
                          <div class="table-responsive">
                            <table class="table table-sm table-dark align-middle mb-2">
                              <thead class="small text-muted">
                                <tr>
                                  <th style="width:4rem;">Level</th>
                                  <th style="width:5rem;">Max</th>
                                  <th style="width:5rem;">Used</th>
                                  <th style="width:auto">Actions</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td>1st</td>
                                  <td><input id="slots1Max"  type="number" class="form-control form-control-sm text-center" min="0" /></td>
                                  <td><input id="slots1Used" type="number" class="form-control form-control-sm text-center" min="0" /></td>
                                  <td> <!-- NEW CELL -->
                                    <div class="btn-group btn-group-sm">
                                      <button class="btn btn-outline-success btn-sm" data-action="use-slot" data-level="1">
                                        <i class="bi bi-dash-circle"></i>
                                      </button>
                                      <button class="btn btn-outline-info btn-sm" data-action="regain-slot" data-level="1">
                                        <i class="bi bi-plus-circle"></i>
                                      </button>
                                      <button class="btn btn-outline-secondary btn-sm" data-action="reset-slot" data-level="1">
                                        <i class="bi bi-arrow-clockwise"></i>
                                      </button>
                                    </div>
                                  </td>
                                </tr>
                                <tr>
                                  <td>2nd</td>
                                  <td><input id="slots2Max"  type="number" class="form-control form-control-sm text-center" min="0" /></td>
                                  <td><input id="slots2Used" type="number" class="form-control form-control-sm text-center" min="0" /></td>
                                  <td> 
                                    <div class="btn-group btn-group-sm">
                                      <button class="btn btn-outline-success btn-sm" data-action="use-slot" data-level="2">
                                        <i class="bi bi-dash-circle"></i>
                                      </button>
                                      <button class="btn btn-outline-info btn-sm" data-action="regain-slot" data-level="2">
                                        <i class="bi bi-plus-circle"></i>
                                      </button>
                                      <button class="btn btn-outline-secondary btn-sm" data-action="reset-slot" data-level="2">
                                        <i class="bi bi-arrow-clockwise"></i>
                                      </button>
                                    </div>
                                  </td>
                                </tr>
                                <tr>
                                  <td>3rd</td>
                                  <td><input id="slots3Max"  type="number" class="form-control form-control-sm text-center" min="0" /></td>
                                  <td><input id="slots3Used" type="number" class="form-control form-control-sm text-center" min="0" /></td>
                                  <td>
                                    <div class="btn-group btn-group-sm">
                                      <button class="btn btn-outline-success btn-sm" data-action="use-slot" data-level="3">
                                        <i class="bi bi-dash-circle"></i>
                                      </button>
                                      <button class="btn btn-outline-info btn-sm" data-action="regain-slot" data-level="3">
                                        <i class="bi bi-plus-circle"></i>
                                      </button>
                                      <button class="btn btn-outline-secondary btn-sm" data-action="reset-slot" data-level="3">
                                        <i class="bi bi-arrow-clockwise"></i>
                                      </button>
                                    </div>
                                  </td>
                                </tr>
                                <tr>
                                  <td>4th</td>
                                  <td><input id="slots4Max"  type="number" class="form-control form-control-sm text-center" min="0" /></td>
                                  <td><input id="slots4Used" type="number" class="form-control form-control-sm text-center" min="0" /></td>
                                  <td>
                                    <div class="btn-group btn-group-sm">
                                      <button class="btn btn-outline-success btn-sm" data-action="use-slot" data-level="4">
                                        <i class="bi bi-dash-circle"></i>
                                      </button>
                                      <button class="btn btn-outline-info btn-sm" data-action="regain-slot" data-level="4">
                                        <i class="bi bi-plus-circle"></i>
                                      </button>
                                      <button class="btn btn-outline-secondary btn-sm" data-action="reset-slot" data-level="4">
                                        <i class="bi bi-arrow-clockwise"></i>
                                      </button>
                                    </div>
                                  </td>
                                </tr>
                                <tr>
                                  <td>5th</td>
                                  <td><input id="slots5Max"  type="number" class="form-control form-control-sm text-center" min="0" /></td>
                                  <td><input id="slots5Used" type="number" class="form-control form-control-sm text-center" min="0" /></td>
                                  <td>
                                    <div class="btn-group btn-group-sm">
                                      <button class="btn btn-outline-success btn-sm" data-action="use-slot" data-level="5">
                                        <i class="bi bi-dash-circle"></i>
                                      </button>
                                      <button class="btn btn-outline-info btn-sm" data-action="regain-slot" data-level="5">
                                        <i class="bi bi-plus-circle"></i>
                                      </button>
                                      <button class="btn btn-outline-secondary btn-sm" data-action="reset-slot" data-level="5">
                                        <i class="bi bi-arrow-clockwise"></i>
                                      </button>
                                    </div>
                                  </td>
                                </tr>
                                <tr>
                                  <td>6th</td>
                                  <td><input id="slots6Max"  type="number" class="form-control form-control-sm text-center" min="0" /></td>
                                  <td><input id="slots6Used" type="number" class="form-control form-control-sm text-center" min="0" /></td>
                                  <td>
                                    <div class="btn-group btn-group-sm">
                                      <button class="btn btn-outline-success btn-sm" data-action="use-slot" data-level="6">
                                        <i class="bi bi-dash-circle"></i>
                                      </button>
                                      <button class="btn btn-outline-info btn-sm" data-action="regain-slot" data-level="6">
                                        <i class="bi bi-plus-circle"></i>
                                      </button>
                                      <button class="btn btn-outline-secondary btn-sm" data-action="reset-slot" data-level="6">
                                        <i class="bi bi-arrow-clockwise"></i>
                                      </button>
                                    </div>
                                  </td>
                                </tr>
                                <tr>
                                  <td>7th</td>
                                  <td><input id="slots7Max"  type="number" class="form-control form-control-sm text-center" min="0" /></td>
                                  <td><input id="slots7Used" type="number" class="form-control form-control-sm text-center" min="0" /></td>
                                  <td>
                                    <div class="btn-group btn-group-sm">
                                      <button class="btn btn-outline-success btn-sm" data-action="use-slot" data-level="7">
                                        <i class="bi bi-dash-circle"></i>
                                      </button>
                                      <button class="btn btn-outline-info btn-sm" data-action="regain-slot" data-level="7">
                                        <i class="bi bi-plus-circle"></i>
                                      </button>
                                      <button class="btn btn-outline-secondary btn-sm" data-action="reset-slot" data-level="7">
                                        <i class="bi bi-arrow-clockwise"></i>
                                      </button>
                                    </div>
                                  </td>
                                </tr>
                                <tr>
                                  <td>8th</td>
                                  <td><input id="slots8Max"  type="number" class="form-control form-control-sm text-center" min="0" /></td>
                                  <td><input id="slots8Used" type="number" class="form-control form-control-sm text-center" min="0" /></td>
                                  <td>
                                    <div class="btn-group btn-group-sm">
                                      <button class="btn btn-outline-success btn-sm" data-action="use-slot" data-level="8">
                                        <i class="bi bi-dash-circle"></i>
                                      </button>
                                      <button class="btn btn-outline-info btn-sm" data-action="regain-slot" data-level="8">
                                        <i class="bi bi-plus-circle"></i>
                                      </button>
                                      <button class="btn btn-outline-secondary btn-sm" data-action="reset-slot" data-level="8">
                                        <i class="bi bi-arrow-clockwise"></i>
                                      </button>
                                    </div>
                                  </td>
                                </tr>
                                <tr>
                                  <td>9th</td>
                                  <td><input id="slots9Max"  type="number" class="form-control form-control-sm text-center" min="0" /></td>
                                  <td><input id="slots9Used" type="number" class="form-control form-control-sm text-center" min="0" /></td>
                                  <td>
                                    <div class="btn-group btn-group-sm">
                                      <button class="btn btn-outline-success btn-sm" data-action="use-slot" data-level="9">
                                        <i class="bi bi-dash-circle"></i>
                                      </button>
                                      <button class="btn btn-outline-info btn-sm" data-action="regain-slot" data-level="9">
                                        <i class="bi bi-plus-circle"></i>
                                      </button>
                                      <button class="btn btn-outline-secondary btn-sm" data-action="reset-slot" data-level="9">
                                        <i class="bi bi-arrow-clockwise"></i>
                                      </button>
                                    </div>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        
                          <div class="row g-2 align-items-end small">
                            <div class="col-4">
                              <label for="pactLevel" class="form-label mb-1">Pact Slot Level</label>
                              <input id="pactLevel" type="number" min="1" max="9"
                                     class="form-control form-control-sm text-center" />
                            </div>
                            <div class="col-4">
                              <label for="pactMax" class="form-label mb-1">Pact Slots</label>
                              <input id="pactMax" type="number" min="0"
                                     class="form-control form-control-sm text-center" />
                            </div>
                            <div class="col-4">
                              <label for="pactUsed" class="form-label mb-1">Used</label>
                              <input id="pactUsed" type="number" min="0"
                                     class="form-control form-control-sm text-center" />
                            </div>
                          </div>
                        </div>
                      
                        <!-- Existing search + results stay unchanged below this -->
                        <div class="mb-2">
                          <div class="input-group input-group-sm mb-2">
                            <span class="input-group-text"><i class="bi bi-search"></i></span>
                            <input type="text"
                                   class="form-control"
                                   id="spellSearchInput"
                                   placeholder="Search spell name, tag, or class..."
                                   autocomplete="off" />
                          </div>
                          <div id="spellSearchResults" class="list-group list-group-flush small"></div>
                        </div>

                          <!-- Custom / homebrew spell entry -->
                          <div class="mb-3">
                            <button class="btn btn-sm btn-outline-success mb-2"
                                    type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#customSpellCollapse"
                                    aria-expanded="false"
                                    aria-controls="customSpellCollapse">
                              <i class="bi bi-magic me-1"></i>Add Custom / Homebrew Spell
                            </button>

                            <div class="collapse" id="customSpellCollapse">
                              <div class="border border-secondary rounded p-2 bg-black bg-opacity-25">
                                <div class="row g-2 mb-2">
                                  <div class="col-12">
                                    <label for="customSpellNameInput" class="form-label small mb-1">Name / Title</label>
                                    <input type="text"
                                           class="form-control form-control-sm"
                                           id="customSpellNameInput"
                                           placeholder="Spell name (required)" />
                                  </div>
                                  <div class="col-4">
                                    <label for="customSpellLevelInput" class="form-label small mb-1">Level</label>
                                    <input type="number"
                                           min="0"
                                           max="9"
                                           class="form-control form-control-sm"
                                           id="customSpellLevelInput" />
                                  </div>
                                  <div class="col-8">
                                    <label for="customSpellSchoolInput" class="form-label small mb-1">School</label>
                                    <input type="text"
                                           class="form-control form-control-sm"
                                           id="customSpellSchoolInput"
                                           placeholder="Evocation, Illusion..." />
                                  </div>
                                  <div class="col-6">
                                    <label for="customSpellCastingInput" class="form-label small mb-1">Casting Time</label>
                                    <input type="text"
                                           class="form-control form-control-sm"
                                           id="customSpellCastingInput"
                                           placeholder="1 action, bonus action..." />
                                  </div>
                                  <div class="col-6">
                                    <label for="customSpellRangeInput" class="form-label small mb-1">Range</label>
                                    <input type="text"
                                           class="form-control form-control-sm"
                                           id="customSpellRangeInput"
                                           placeholder="60 ft, Self (30-ft cone)..." />
                                  </div>
                                  <div class="col-6">
                                    <label for="customSpellComponentsInput" class="form-label small mb-1">Components</label>
                                    <input type="text"
                                           class="form-control form-control-sm"
                                           id="customSpellComponentsInput"
                                           placeholder="V,S,M (a pearl worth 100 gp)" />
                                  </div>
                                  <div class="col-6">
                                    <label for="customSpellDurationInput" class="form-label small mb-1">Duration</label>
                                    <input type="text"
                                           class="form-control form-control-sm"
                                           id="customSpellDurationInput"
                                           placeholder="Instantaneous, 1 minute, up to 1 hour..." />
                                  </div>
                                  <div class="col-6 d-flex align-items-center">
                                    <div class="form-check mt-3">
                                      <input class="form-check-input"
                                             type="checkbox"
                                             id="customSpellConcentrationInput" />
                                      <label class="form-check-label small" for="customSpellConcentrationInput">
                                        Concentration
                                      </label>
                                    </div>
                                  </div>
                                  <div class="col-6">
                                    <label for="customSpellClassesInput" class="form-label small mb-1">Classes</label>
                                    <input type="text"
                                           class="form-control form-control-sm"
                                           id="customSpellClassesInput"
                                           placeholder="Wizard, Cleric (comma-separated)" />
                                  </div>
                                  <div class="col-12">
                                    <label for="customSpellTagsInput" class="form-label small mb-1">Tags</label>
                                    <input type="text"
                                           class="form-control form-control-sm"
                                           id="customSpellTagsInput"
                                           placeholder="damage, control, fire (comma-separated)" />
                                  </div>
                                  <div class="col-12">
                                    <label for="customSpellBodyInput" class="form-label small mb-1">Description</label>
                                    <textarea class="form-control form-control-sm"
                                              id="customSpellBodyInput"
                                              rows="3"
                                              placeholder="Full spell rules text / summary."></textarea>
                                  </div>
                                </div>

                                <div class="d-flex justify-content-end">
                                  <button class="btn btn-sm btn-success"
                                          type="button"
                                          id="saveCustomSpellBtn">
                                    <i class="bi bi-plus-circle me-1"></i>Add to Known Spells
                                  </button>
                                </div>

                                <small class="text-muted d-block mt-1">
                                  Custom spells are stored only on this characterâ€™s spell list.
                                </small>
                              </div>
                            </div>
                          </div>
                      
                          <div class="mt-3">
                            <div class="d-flex justify-content-between align-items-center mb-1">
                              <span class="fw-bold small">Known Spells</span>
                              <button type="button"
                                      class="btn btn-sm btn-outline-danger"
                                      id="clearSpellListBtn">
                                Clear All
                              </button>
                            </div>
                            <ul class="list-group list-group-flush small" id="characterSpellList">
                              <!-- Populated by JS -->
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Inventory -->
                  <div class="tab-pane fade"
                       id="detail-inventory-pane"
                       role="tabpanel"
                       aria-labelledby="detail-inventory-tab">
                    <div class="mt-2" id="section-inventory">
                      <label for="charInventory" class="form-label">Key Gear / Magic Items</label>
                      <textarea id="charInventory" rows="3" class="form-control form-control-sm"
                                placeholder="Weapons, armor, magic items, consumables that matter regularly."></textarea>
                    </div>
                  </div>

                  <!-- Features & Traits -->
                  <div class="tab-pane fade"
                       id="detail-features-pane"
                       role="tabpanel"
                       aria-labelledby="detail-features-tab">
                    <div class="mt-2" id="section-features">
                      <label for="charFeatures" class="form-label">Features & Feats</label>
                      <textarea id="charFeatures" rows="4" class="form-control form-control-sm"
                                placeholder="Key class features, feats, reactions, bonus actions, etc. Focus on what matters for you behind the screen."></textarea>
                    </div>
                  </div>

                  <!-- Background -->
                  <div class="tab-pane fade"
                       id="detail-background-pane"
                       role="tabpanel"
                       aria-labelledby="detail-background-tab">
                    <div class="mt-2" id="section-background">
                      <label for="charNotes" class="form-label">Story, Hooks &amp; Secrets</label>
                      <textarea id="charNotes" rows="4" class="form-control form-control-sm"
                                placeholder="Backstory beats, faction ties, secrets, upcoming reveals, relationship notes, etc."></textarea>
                    </div>
                  </div>

                  <!-- Generic Notes -->
                  <div class="tab-pane fade"
                       id="detail-notes-pane"
                       role="tabpanel"
                       aria-labelledby="detail-notes-tab">
                    <div class="mt-2">
                      <label for="charExtraNotes" class="form-label">Miscellaneous Notes</label>
                      <textarea id="charExtraNotes" rows="4" class="form-control form-control-sm"
                                placeholder="Scratch space, prep notes, anything that doesnâ€™t fit the other tabs."></textarea>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div> <!-- /row -->
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="container-fluid mt-5 site-footer" role="contentinfo">
    <div class="footer-main py-3">
      <div class="container">
        <div class="row align-items-center text-center text-md-start">
          <!-- Left: Copyright -->
          <div class="col-12 col-md-4 mb-2 mb-md-0 text-md-start text-center">
            <small class="text-muted">&copy; 2025 Maybeme | The DMâ€™s Toolbox</small>
          </div>

          <!-- Center: Logo -->
          <div class="col-12 col-md-4 text-center mb-2 mb-md-0">
            <img src="/images/White logo - no background.png" height="40" alt="Logo" class="footer-logo">
          </div>

          <!-- Right: Social Links -->
          <div class="col-12 col-md-4 d-flex justify-content-center justify-content-md-end align-items-center gap-2">
            <a href="https://www.linkedin.com/in/marlo-mayberry-930ab9b7/" class="socialicons" target="_blank" rel="noopener" aria-label="LinkedIn">
              <i class="bi bi-linkedin"></i>
            </a>
            <a href="https://github.com/M-ybeme" class="socialicons" target="_blank" rel="noopener" aria-label="GitHub">
              <i class="bi bi-github"></i>
            </a>
            <a href="https://ko-fi.com/maybemestoolbox" class="socialicons d-flex align-items-center" target="_blank" rel="noopener" title="Support The DMâ€™s Toolbox on Ko-fi">
              <i class="bi bi-cup-hot"></i>
            </a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- Attack Editor Modal -->
  <div class="modal fade" id="attackModal" tabindex="-1" aria-labelledby="attackModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content bg-dark text-light border-secondary">
        <div class="modal-header border-secondary">
          <h5 class="modal-title" id="attackModalLabel">Add/Edit Attack</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="attackEditIndex" value="" />

          <div class="mb-3">
            <label for="attackName" class="form-label">Attack Name</label>
            <input type="text" class="form-control form-control-sm" id="attackName" placeholder="Longsword, Fire Bolt, Unarmed Strike..." />
          </div>

          <div class="row g-2 mb-3">
            <div class="col-6">
              <label for="attackType" class="form-label">Attack Type</label>
              <select class="form-select form-select-sm" id="attackType">
                <option value="melee-weapon">Melee Weapon Attack</option>
                <option value="ranged-weapon">Ranged Weapon Attack</option>
                <option value="melee-spell">Melee Spell Attack</option>
                <option value="ranged-spell">Ranged Spell Attack</option>
                <option value="save">Saving Throw</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="col-6">
              <label for="attackRange" class="form-label">Range</label>
              <input type="text" class="form-control form-control-sm" id="attackRange" placeholder="5 ft, 30/120 ft..." />
            </div>
          </div>

          <div class="row g-2 mb-3">
            <div class="col-6">
              <label for="attackBonus" class="form-label">Attack Bonus</label>
              <input type="text" class="form-control form-control-sm" id="attackBonus" placeholder="+5, +8..." />
            </div>
            <div class="col-6">
              <label for="attackSaveDC" class="form-label">Save DC (if applicable)</label>
              <input type="text" class="form-control form-control-sm" id="attackSaveDC" placeholder="DC 15, DC 18..." />
            </div>
          </div>

          <div class="mb-3">
            <label for="attackDamage" class="form-label">Damage</label>
            <input type="text" class="form-control form-control-sm" id="attackDamage" placeholder="1d8+3 slashing, 2d6 fire..." />
          </div>

          <div class="mb-3">
            <label for="attackDamage2" class="form-label">Additional Damage (optional)</label>
            <input type="text" class="form-control form-control-sm" id="attackDamage2" placeholder="1d6 poison, 2d6 sneak attack..." />
          </div>

          <div class="mb-3">
            <label for="attackProperties" class="form-label">Properties / Notes</label>
            <textarea class="form-control form-control-sm" id="attackProperties" rows="2" placeholder="Versatile (1d10), reach, finesse, magical..."></textarea>
          </div>
        </div>
        <div class="modal-footer border-secondary">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-success" id="saveAttackBtn">
            <i class="bi bi-check2-circle me-1"></i>Save Attack
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Portrait Editing Modal -->
  <div class="modal fade" id="portraitModal" tabindex="-1" aria-labelledby="portraitModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content bg-dark text-light border-secondary">
        <div class="modal-header border-secondary">
          <h5 class="modal-title" id="portraitModalLabel">Adjust Portrait Framing</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3 portrait-frame" style="height: 420px; cursor: grab;" id="portraitContainerModal">
            <img id="portraitPreviewModal"
                 class="portrait-image d-none"
                 alt="Portrait being edited" />
            <span id="portraitPlaceholderModal"
                  class="text-muted position-absolute top-50 start-50 translate-middle text-center">
              No image loaded
            </span>
          </div>

          <div class="mb-3">
            <label for="portraitZoomModal" class="form-label mb-1">Zoom</label>
            <input type="range" id="portraitZoomModal" min="1" max="3" step="0.05" class="form-range" />
            <small class="text-muted">Drag inside the frame to reposition the portrait.</small>
          </div>
        </div>
        <div class="modal-footer border-secondary">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-success" id="savePortraitModalBtn">
            <i class="bi bi-check2-circle me-1"></i>Save Portrait
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Character Creation Wizard Modal -->
  <div class="modal fade" id="characterCreationModal" tabindex="-1" aria-labelledby="characterCreationModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header border-secondary">
          <h5 class="modal-title" id="wizardTitle">Character Creation Wizard</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="wizardBody">
          <!-- Wizard content populated by JS -->
        </div>
        <div class="modal-footer border-secondary d-flex justify-content-between" id="wizardFooter">
          <!-- Wizard buttons populated by JS -->
        </div>
      </div>
    </div>
  </div>

  <script src="/js/spells-data.js"></script>
  <script src="/js/character-creation-wizard.js"></script>
  <script src="/js/character.js"></script>
</body>
</html>
