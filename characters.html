<!DOCTYPE html> 
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The DM's Toolbox: Characters</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
  <!-- Custom CSS -->
  <link href="/css/site.css" rel="stylesheet" />
  <!-- Dev Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/devicons/devicon@v2.15.1/devicon.min.css" />
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/images/dndFavicon (2).png" />

  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <script src="/js/site.js"></script>

  <style>
    .bgimage{
      background: url('images/BGMap.png') no-repeat center center fixed;
      background-size: cover;
    }
    .bg-orange { background-color: #fd7e14 !important; color: #212529 !important; }
    .drag-handle { cursor: move; }
    .active-turn {
      border-left: 5px solid #1d9e6d !important;
      color: #f8f9fa !important;
      font-weight: bold;
    }
    #saveHistorySelect { min-width: 200px; }

    .backdrop {
      background: rgba(0, 0, 0, 0.65);
      border-radius: 0.5rem;
      padding: 1rem;
    }

    .portrait-frame {
      overflow: hidden;
      position: relative;
      border-radius: 0.5rem;
      border: 1px solid rgba(255,255,255,0.15);
      background-color: rgba(15,15,15,0.9);
    }

    .portrait-image {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(1);
      transform-origin: center center;
      user-select: none;
      -webkit-user-drag: none;
      max-width: none;
      max-height: none;
      min-width: 100%;
      min-height: 100%;
    }

    .skill-table th,
    .skill-table td {
      padding: 0.25rem 0.4rem;
      vertical-align: middle;
    }

    .skill-table input[type="number"] {
      max-width: 3.5rem;
    }

    .save-pill {
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.2);
      padding: 0.25rem 0.6rem;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .save-pill label {
      margin-bottom: 0;
    }

    .save-pill input[type="number"] {
      max-width: 3.5rem;
    }
  </style>
</head>
<body class="bgimage">
  <!-- Nav -->
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top text-light" id="mainNav">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">
        <img src="/images/dndFavicon (2).png" height="40" width="40" alt="App Logo" class="d-inline-block" />
        The DM Toolbox
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
              aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" href="index.html">Initiative</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="name.html">Name Gen</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="loot.html">Loot Gen</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="shop.html">Shop Gen</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="npc.html">NPC Gen</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="tav.html">Tavern/Inn Gen</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="battlemap.html">Battle Map</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="encounterbuilder.html">Encounter Builder</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="characters.html">Characters</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main -->
  <main class="content pt-4">
    <div class="container-fluid mt-5 pt-3">
      <div class="container backdrop text-light">
        <!-- Header + Character Selector / Actions -->
        <div class="d-flex flex-column flex-md-row align-items-md-center mb-3 gap-3">
          <div>
            <h2 class="mb-0">Character Manager</h2>
            <small class="text-muted">DM-focused character sheets with portraits, saved locally in your browser.</small>
          </div>

          <div class="ms-md-auto w-100 w-md-auto d-flex flex-column flex-lg-row gap-2 align-items-stretch align-items-lg-center mt-3 mt-md-0">
            <div class="d-flex flex-column flex-lg-row gap-2 align-items-stretch align-items-lg-center flex-grow-1">
              <select id="characterSelect" class="form-select" aria-label="Select Character">
                <!-- Populated by JS -->
              </select>

              <div class="btn-group flex-wrap" role="group" aria-label="Character actions">
                <button type="button" class="btn btn-sm btn-outline-light" id="newCharacterBtn">
                  <i class="bi bi-person-plus me-1"></i>New
                </button>
                <button type="button" class="btn btn-sm btn-outline-light" id="saveCharacterBtn">
                  <i class="bi bi-save me-1"></i>Save
                </button>
                <button type="button" class="btn btn-sm btn-outline-light" id="deleteCharacterBtn">
                  <i class="bi bi-trash me-1"></i>Delete
                </button>
              </div>
            </div>

            <div class="d-flex flex-wrap gap-2 justify-content-start justify-content-lg-end">
              <button type="button" class="btn btn-sm btn-outline-info" id="exportCharacterBtn" title="Export current character as JSON">
                <i class="bi bi-download me-1"></i>Export
              </button>
              <button type="button" class="btn btn-sm btn-outline-warning" id="sendToTrackerBtn" title="Send current character to the Initiative Tracker">
                <i class="bi bi-arrow-right-circle me-1"></i>Send to Initiative Tracker
              </button>
              <button type="button" class="btn btn-sm btn-outline-info" id="exportAllCharactersBtn" title="Export all characters as JSON">
                <i class="bi bi-archive me-1"></i>Export All
              </button>

              <div class="position-relative">
                <input type="file" id="importFileInput" accept="application/json" class="d-none" />
                <button type="button" class="btn btn-sm btn-outline-warning" id="importCharacterBtn" title="Import character JSON">
                  <i class="bi bi-upload me-1"></i>Import
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Last updated -->
        <div class="mb-3">
          <small id="lastUpdatedText" class="text-muted"></small>
        </div>

        <!-- Main layout -->
        <div class="row g-3">
          <!-- LEFT COLUMN -->
          <div class="col-12 col-lg-8">
            <!-- Basic Identity -->
            <div class="card bg-dark border-secondary mb-3">
              <div class="card-header border-secondary">
                <strong>Basic Information</strong>
              </div>
              <div class="card-body">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="charName" class="form-label">Character Name</label>
                    <input type="text" id="charName" class="form-control form-control-sm" placeholder="Valen Khorath" />
                  </div>
                  <div class="col-md-6">
                    <label for="playerName" class="form-label">Player Name</label>
                    <input type="text" id="playerName" class="form-control form-control-sm" placeholder="Player / seat" />
                  </div>

                  <div class="col-md-4">
                    <label for="charRace" class="form-label">Race / Ancestry</label>
                    <input type="text" id="charRace" class="form-control form-control-sm" placeholder="Tiefling, Human, Owlin..." />
                  </div>
                  <div class="col-md-4">
                    <label for="charClass" class="form-label">Class / Subclass</label>
                    <input type="text" id="charClass" class="form-control form-control-sm" placeholder="Illrigger, Wizard (Evocation)..." />
                  </div>
                  <div class="col-md-2">
                    <label for="charLevel" class="form-label">Level</label>
                    <input type="number" min="1" max="20" id="charLevel" class="form-control form-control-sm" />
                  </div>
                  <div class="col-md-2">
                    <label for="charAlignment" class="form-label">Alignment</label>
                    <input type="text" id="charAlignment" class="form-control form-control-sm" placeholder="NG, LE..." />
                  </div>

                  <div class="col-md-12">
                    <label for="charRoleNotes" class="form-label">Party Role / DM Notes</label>
                    <textarea id="charRoleNotes" rows="2" class="form-control form-control-sm"
                              placeholder="Tank, face, skill monkey, spell slot battery, chaos gremlin... plus any quick reminders for you as DM."></textarea>
                  </div>
                </div>
              </div>
            </div>

            <!-- Combat block -->
            <div class="card bg-dark border-secondary mb-3" id="section-actions">
              <div class="card-header border-secondary">
                <strong>Combat Snapshot</strong>
              </div>
              <div class="card-body">
                <div class="row g-3">
                  <div class="col-6 col-md-3">
                    <label for="charAC" class="form-label">AC</label>
                    <input type="number" id="charAC" class="form-control form-control-sm" />
                  </div>
                  <div class="col-6 col-md-3">
                    <label for="charMaxHP" class="form-label">Max HP</label>
                    <input type="number" id="charMaxHP" class="form-control form-control-sm" />
                  </div>
                  <div class="col-6 col-md-3">
                    <label for="charCurrentHP" class="form-label">Current HP</label>
                    <input type="number" id="charCurrentHP" class="form-control form-control-sm" />
                  </div>
                  <div class="col-6 col-md-3">
                    <label for="charSpeed" class="form-label">Speed</label>
                    <input type="text" id="charSpeed" class="form-control form-control-sm" placeholder="30 ft, 40 ft fly..." />
                  </div>

                  <div class="col-6 col-md-3">
                    <label for="charInitMod" class="form-label">Initiative Mod</label>
                    <input type="number" id="charInitMod" class="form-control form-control-sm" />
                  </div>
                  <div class="col-12 col-md-9">
                    <label for="charConditions" class="form-label">Conditions / Ongoing Effects</label>
                    <input type="text" id="charConditions" class="form-control form-control-sm"
                           placeholder="Blessed, hexed, cursed, attuned items, etc." />
                  </div>
                </div>
              </div>
            </div>

            <!-- Ability Scores + Modifiers -->
            <div class="card bg-dark border-secondary mb-3">
              <div class="card-header border-secondary">
                <strong>Ability Scores & Modifiers</strong>
              </div>
              <div class="card-body">
                <div class="row g-3 text-center">
                  <!-- STR -->
                  <div class="col-6 col-md-2">
                    <label for="statStr" class="form-label">STR</label>
                    <input type="number" id="statStr" class="form-control form-control-sm text-center mb-1" placeholder="Score" />
                    <input type="number" id="modStr" class="form-control form-control-sm text-center" placeholder="Mod" />
                  </div>
                  <!-- DEX -->
                  <div class="col-6 col-md-2">
                    <label for="statDex" class="form-label">DEX</label>
                    <input type="number" id="statDex" class="form-control form-control-sm text-center mb-1" placeholder="Score" />
                    <input type="number" id="modDex" class="form-control form-control-sm text-center" placeholder="Mod" />
                  </div>
                  <!-- CON -->
                  <div class="col-6 col-md-2">
                    <label for="statCon" class="form-label">CON</label>
                    <input type="number" id="statCon" class="form-control form-control-sm text-center mb-1" placeholder="Score" />
                    <input type="number" id="modCon" class="form-control form-control-sm text-center" placeholder="Mod" />
                  </div>
                  <!-- INT -->
                  <div class="col-6 col-md-2">
                    <label for="statInt" class="form-label">INT</label>
                    <input type="number" id="statInt" class="form-control form-control-sm text-center mb-1" placeholder="Score" />
                    <input type="number" id="modInt" class="form-control form-control-sm text-center" placeholder="Mod" />
                  </div>
                  <!-- WIS -->
                  <div class="col-6 col-md-2">
                    <label for="statWis" class="form-label">WIS</label>
                    <input type="number" id="statWis" class="form-control form-control-sm text-center mb-1" placeholder="Score" />
                    <input type="number" id="modWis" class="form-control form-control-sm text-center" placeholder="Mod" />
                  </div>
                  <!-- CHA -->
                  <div class="col-6 col-md-2">
                    <label for="statCha" class="form-label">CHA</label>
                    <input type="number" id="statCha" class="form-control form-control-sm text-center mb-1" placeholder="Score" />
                    <input type="number" id="modCha" class="form-control form-control-sm text-center" placeholder="Mod" />
                  </div>
                </div>
              </div>
            </div>

            <!-- Saving Throws -->
            <div class="card bg-dark border-secondary mb-3">
              <div class="card-header border-secondary d-flex justify-content-between align-items-center">
                <strong>Saving Throws</strong>
              </div>
              <div class="card-body">
                <div class="row g-2">
                  <!-- STR save -->
                  <div class="col-6 col-md-4 col-lg-2">
                    <div class="save-pill">
                      <div class="form-check mb-0">
                        <input class="form-check-input" type="checkbox" id="saveStrProf" />
                      </div>
                      <label for="saveStrBonus" class="fw-bold small">STR</label>
                      <input type="number" id="saveStrBonus" class="form-control form-control-sm text-center" placeholder="0" />
                    </div>
                  </div>
                  <!-- DEX save -->
                  <div class="col-6 col-md-4 col-lg-2">
                    <div class="save-pill">
                      <div class="form-check mb-0">
                        <input class="form-check-input" type="checkbox" id="saveDexProf" />
                      </div>
                      <label for="saveDexBonus" class="fw-bold small">DEX</label>
                      <input type="number" id="saveDexBonus" class="form-control form-control-sm text-center" placeholder="0" />
                    </div>
                  </div>
                  <!-- CON save -->
                  <div class="col-6 col-md-4 col-lg-2">
                    <div class="save-pill">
                      <div class="form-check mb-0">
                        <input class="form-check-input" type="checkbox" id="saveConProf" />
                      </div>
                      <label for="saveConBonus" class="fw-bold small">CON</label>
                      <input type="number" id="saveConBonus" class="form-control form-control-sm text-center" placeholder="0" />
                    </div>
                  </div>
                  <!-- INT save -->
                  <div class="col-6 col-md-4 col-lg-2">
                    <div class="save-pill">
                      <div class="form-check mb-0">
                        <input class="form-check-input" type="checkbox" id="saveIntProf" />
                      </div>
                      <label for="saveIntBonus" class="fw-bold small">INT</label>
                      <input type="number" id="saveIntBonus" class="form-control form-control-sm text-center" placeholder="0" />
                    </div>
                  </div>
                  <!-- WIS save -->
                  <div class="col-6 col-md-4 col-lg-2">
                    <div class="save-pill">
                      <div class="form-check mb-0">
                        <input class="form-check-input" type="checkbox" id="saveWisProf" />
                      </div>
                      <label for="saveWisBonus" class="fw-bold small">WIS</label>
                      <input type="number" id="saveWisBonus" class="form-control form-control-sm text-center" placeholder="0" />
                    </div>
                  </div>
                  <!-- CHA save -->
                  <div class="col-6 col-md-4 col-lg-2">
                    <div class="save-pill">
                      <div class="form-check mb-0">
                        <input class="form-check-input" type="checkbox" id="saveChaProf" />
                      </div>
                      <label for="saveChaBonus" class="fw-bold small">CHA</label>
                      <input type="number" id="saveChaBonus" class="form-control form-control-sm text-center" placeholder="0" />
                    </div>
                  </div>
                </div>

                <div class="mt-3">
                  <label for="saveNotes" class="form-label">Saving Throw Notes</label>
                  <textarea id="saveNotes" rows="2" class="form-control form-control-sm"
                            placeholder="e.g. Advantage vs frightened, resistance to fire, etc."></textarea>
                </div>
              </div>
            </div>

            <!-- Skills -->
            <div class="card bg-dark border-secondary mb-3">
              <div class="card-header border-secondary d-flex justify-content-between align-items-center">
                <strong>Skills</strong>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-sm table-dark table-striped align-middle mb-2 skill-table">
                    <thead>
                      <tr class="text-muted small">
                        <th scope="col" style="width:2rem;">Prof</th>
                        <th scope="col" style="width:3rem;">Mod</th>
                        <th scope="col">Skill</th>
                        <th scope="col" style="width:4rem;" class="text-center">Bonus</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillAcrobaticsProf" class="form-check-input" />
                        </td>
                        <td>DEX</td>
                        <td>Acr<span class="d-none d-md-inline">obatics</span></td>
                        <td class="text-center">
                          <input type="number" id="skillAcrobaticsBonus" class="form-control form-control-sm text-center" />
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillAnimalHandlingProf" class="form-check-input" />
                        </td>
                        <td>WIS</td>
                        <td>Animal Handling</td>
                        <td class="text-center">
                          <input type="number" id="skillAnimalHandlingBonus" class="form-control form-control-sm text-center" />
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillArcanaProf" class="form-check-input" />
                        </td>
                        <td>INT</td>
                        <td>Arcana</td>
                        <td class="text-center">
                          <input type="number" id="skillArcanaBonus" class="form-control form-control-sm text-center" />
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillAthleticsProf" class="form-check-input" />
                        </td>
                        <td>STR</td>
                        <td>Athletics</td>
                        <td class="text-center">
                          <input type="number" id="skillAthleticsBonus" class="form-control form-control-sm text-center" />
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillDeceptionProf" class="form-check-input" />
                        </td>
                        <td>CHA</td>
                        <td>Deception</td>
                        <td class="text-center">
                          <input type="number" id="skillDeceptionBonus" class="form-control form-control-sm text-center" />
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillHistoryProf" class="form-check-input" />
                        </td>
                        <td>INT</td>
                        <td>History</td>
                        <td class="text-center">
                          <input type="number" id="skillHistoryBonus" class="form-control form-control-sm text-center" />
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillInsightProf" class="form-check-input" />
                        </td>
                        <td>WIS</td>
                        <td>Insight</td>
                        <td class="text-center">
                          <input type="number" id="skillInsightBonus" class="form-control form-control-sm text-center" />
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillIntimidationProf" class="form-check-input" />
                        </td>
                        <td>CHA</td>
                        <td>Intimidation</td>
                        <td class="text-center">
                          <input type="number" id="skillIntimidationBonus" class="form-control form-control-sm text-center" />
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillInvestigationProf" class="form-check-input" />
                        </td>
                        <td>INT</td>
                        <td>Investigation</td>
                        <td class="text-center">
                          <input type="number" id="skillInvestigationBonus" class="form-control form-control-sm text-center" />
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillMedicineProf" class="form-check-input" />
                        </td>
                        <td>WIS</td>
                        <td>Medicine</td>
                        <td class="text-center">
                          <input type="number" id="skillMedicineBonus" class="form-control form-control-sm text-center" />
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillNatureProf" class="form-check-input" />
                        </td>
                        <td>INT</td>
                        <td>Nature</td>
                        <td class="text-center">
                          <input type="number" id="skillNatureBonus" class="form-control form-control-sm text-center" />
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillPerceptionProf" class="form-check-input" />
                        </td>
                        <td>WIS</td>
                        <td>Perception</td>
                        <td class="text-center">
                          <input type="number" id="skillPerceptionBonus" class="form-control form-control-sm text-center" />
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillPerformanceProf" class="form-check-input" />
                        </td>
                        <td>CHA</td>
                        <td>Performance</td>
                        <td class="text-center">
                          <input type="number" id="skillPerformanceBonus" class="form-control form-control-sm text-center" />
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillPersuasionProf" class="form-check-input" />
                        </td>
                        <td>CHA</td>
                        <td>Persuasion</td>
                        <td class="text-center">
                          <input type="number" id="skillPersuasionBonus" class="form-control form-control-sm text-center" />
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillReligionProf" class="form-check-input" />
                        </td>
                        <td>INT</td>
                        <td>Religion</td>
                        <td class="text-center">
                          <input type="number" id="skillReligionBonus" class="form-control form-control-sm text-center" />
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillSleightOfHandProf" class="form-check-input" />
                        </td>
                        <td>DEX</td>
                        <td>Sleight of Hand</td>
                        <td class="text-center">
                          <input type="number" id="skillSleightOfHandBonus" class="form-control form-control-sm text-center" />
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillStealthProf" class="form-check-input" />
                        </td>
                        <td>DEX</td>
                        <td>Stealth</td>
                        <td class="text-center">
                          <input type="number" id="skillStealthBonus" class="form-control form-control-sm text-center" />
                        </td>
                      </tr>
                      <tr>
                        <td class="text-center">
                          <input type="checkbox" id="skillSurvivalProf" class="form-check-input" />
                        </td>
                        <td>WIS</td>
                        <td>Survival</td>
                        <td class="text-center">
                          <input type="number" id="skillSurvivalBonus" class="form-control form-control-sm text-center" />
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <label for="skillsNotes" class="form-label">Additional Skills / Expertise Notes</label>
                <textarea id="skillsNotes" rows="2" class="form-control form-control-sm"
                          placeholder="Expertise, jack-of-all-trades, custom skills, etc."></textarea>
              </div>
            </div>
          </div>

          <!-- RIGHT COLUMN -->
          <div class="col-12 col-lg-4">
            <!-- Portrait (preview only, edits via modal) -->
            <div class="card bg-dark border-secondary mb-3">
              <div class="card-header border-secondary d-flex justify-content-between align-items-center">
                <strong>Character Portrait</strong>
              </div>
              <div class="card-body">
                <div id="portraitContainer"
                     class="portrait-frame mb-3"
                     style="height: 320px;">
                  <img id="portraitPreview"
                       class="portrait-image d-none"
                       alt="Character portrait preview" />
                  <span id="portraitPlaceholderText" class="text-muted position-absolute top-50 start-50 translate-middle text-center">
                    No portrait selected
                  </span>
                </div>

                <div class="mb-2">
                  <label for="portraitFile" class="form-label">Upload Portrait Image</label>
                  <input type="file" id="portraitFile" class="form-control form-control-sm" accept="image/*" />
                  <small class="text-muted">Stored as base64 in your browser’s local storage.</small>
                </div>

                <div class="mb-2">
                  <label for="portraitUrl" class="form-label">Or Use Image URL</label>
                  <div class="input-group input-group-sm">
                    <span class="input-group-text"><i class="bi bi-link-45deg"></i></span>
                    <input type="url" id="portraitUrl" class="form-control" placeholder="https://example.com/image.png" />
                    <button class="btn btn-outline-light" type="button" id="applyPortraitUrlBtn">Use URL</button>
                  </div>
                </div>

                <div class="d-flex flex-wrap gap-2 mt-2">
                  <button type="button" class="btn btn-sm btn-outline-light" id="editPortraitBtn">
                    <i class="bi bi-crop me-1"></i>Edit Portrait Framing
                  </button>
                  <button type="button" class="btn btn-sm btn-outline-danger ms-auto" id="clearPortraitBtn">
                    <i class="bi bi-x-circle me-1"></i>Clear Portrait
                  </button>
                </div>
              </div>
            </div>

            <!-- Senses -->
            <div class="card bg-dark border-secondary mb-3" id="section-extras">
              <div class="card-header border-secondary">
                <strong>Senses</strong>
              </div>
              <div class="card-body">
                <div class="row g-3">
                  <div class="col-4">
                    <label for="charPassivePerception" class="form-label small">Passive Perception</label>
                    <input type="number" id="charPassivePerception" class="form-control form-control-sm text-center" />
                  </div>
                  <div class="col-4">
                    <label for="charPassiveInvestigation" class="form-label small">Passive Investigation</label>
                    <input type="number" id="charPassiveInvestigation" class="form-control form-control-sm text-center" />
                  </div>
                  <div class="col-4">
                    <label for="charPassiveInsight" class="form-label small">Passive Insight</label>
                    <input type="number" id="charPassiveInsight" class="form-control form-control-sm text-center" />
                  </div>

                  <div class="col-12">
                    <label for="sensesNotes" class="form-label">Additional Sense Types</label>
                    <textarea id="sensesNotes" rows="2" class="form-control form-control-sm"
                              placeholder="Darkvision, tremorsense, blindsight, truesight, special perception rules, etc."></textarea>
                  </div>
                </div>
              </div>
            </div>

            <!-- Detailed Notes with DDB-style tabs -->
            <div class="card bg-dark border-secondary mb-3" id="section-notes">
              <div class="card-header border-secondary">
                <strong>Detailed Notes</strong>
              </div>
              <div class="card-body">
                <!-- Tabs for this block -->
                <ul class="nav nav-tabs small mb-3" id="detailTabs" role="tablist">
                  <li class="nav-item" role="presentation">
                    <button class="nav-link active"
                            id="detail-actions-tab"
                            data-bs-toggle="tab"
                            data-bs-target="#detail-actions-pane"
                            type="button"
                            role="tab"
                            aria-controls="detail-actions-pane"
                            aria-selected="true">
                      Action Notes
                    </button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link"
                            id="detail-spells-tab"
                            data-bs-toggle="tab"
                            data-bs-target="#detail-spells-pane"
                            type="button"
                            role="tab"
                            aria-controls="detail-spells-pane"
                            aria-selected="false">
                      Spells
                    </button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link"
                            id="detail-inventory-tab"
                            data-bs-toggle="tab"
                            data-bs-target="#detail-inventory-pane"
                            type="button"
                            role="tab"
                            aria-controls="detail-inventory-pane"
                            aria-selected="false">
                      Inventory
                    </button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link"
                            id="detail-features-tab"
                            data-bs-toggle="tab"
                            data-bs-target="#detail-features-pane"
                            type="button"
                            role="tab"
                            aria-controls="detail-features-pane"
                            aria-selected="false">
                      Features &amp; Traits
                    </button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link"
                            id="detail-background-tab"
                            data-bs-toggle="tab"
                            data-bs-target="#detail-background-pane"
                            type="button"
                            role="tab"
                            aria-controls="detail-background-pane"
                            aria-selected="false">
                      Background
                    </button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link"
                            id="detail-notes-tab"
                            data-bs-toggle="tab"
                            data-bs-target="#detail-notes-pane"
                            type="button"
                            role="tab"
                            aria-controls="detail-notes-pane"
                            aria-selected="false">
                      Notes
                    </button>
                  </li>
                </ul>

                <div class="tab-content">
                  <!-- Action Notes -->
                  <div class="tab-pane fade show active"
                       id="detail-actions-pane"
                       role="tabpanel"
                       aria-labelledby="detail-actions-tab">
                    <label for="charTableNotes" class="form-label">At-the-Table Reminders</label>
                    <textarea id="charTableNotes" rows="4" class="form-control form-control-sm"
                              placeholder="Short, brutal notes: what they want right now, likely actions, roleplay voice, conflicts, etc."></textarea>
                  </div>

                  <!-- Spells -->
                  <div class="tab-pane fade"
                       id="detail-spells-pane"
                       role="tabpanel"
                       aria-labelledby="detail-spells-tab">
                    <div class="mb-2" id="section-spells">
                      <label class="form-label">Spells / Resources</label>

                      <!-- Inner Spells Tabs -->
                      <ul class="nav nav-tabs small" id="spellsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                          <button class="nav-link active"
                                  id="spells-notes-tab"
                                  data-bs-toggle="tab"
                                  data-bs-target="#spells-notes-pane"
                                  type="button"
                                  role="tab"
                                  aria-controls="spells-notes-pane"
                                  aria-selected="true">
                            Notes
                          </button>
                        </li>
                        <li class="nav-item" role="presentation">
                          <button class="nav-link"
                                  id="spells-list-tab"
                                  data-bs-toggle="tab"
                                  data-bs-target="#spells-list-pane"
                                  type="button"
                                  role="tab"
                                  aria-controls="spells-list-pane"
                                  aria-selected="false">
                            Spell List
                          </button>
                        </li>
                      </ul>
                  
                      <div class="tab-content border border-secondary border-top-0 rounded-bottom p-2 bg-black bg-opacity-25">
                        <!-- Notes tab (freeform field) -->
                        <div class="tab-pane fade show active"
                             id="spells-notes-pane"
                             role="tabpanel"
                             aria-labelledby="spells-notes-tab">
                          <textarea id="charSpells" rows="4" class="form-control form-control-sm"
                                    placeholder="Signature spells, pact slots, channel divinity, rage uses, ki, etc."></textarea>
                        </div>
                    
                        <!-- Spell List tab -->
                        <div class="tab-pane fade"
                             id="spells-list-pane"
                             role="tabpanel"
                             aria-labelledby="spells-list-tab">
                    
                          <div class="mb-2">
                            <div class="input-group input-group-sm mb-2">
                              <span class="input-group-text"><i class="bi bi-search"></i></span>
                              <input type="text"
                                     class="form-control"
                                     id="spellSearchInput"
                                     placeholder="Search spell name, tag, or class..."
                                     autocomplete="off" />
                            </div>
                            <div id="spellSearchResults" class="list-group list-group-flush small"></div>
                          </div>

                                                   <!-- Custom / homebrew spell entry -->
                          <div class="mb-3">
                            <button class="btn btn-sm btn-outline-success mb-2"
                                    type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#customSpellCollapse"
                                    aria-expanded="false"
                                    aria-controls="customSpellCollapse">
                              <i class="bi bi-magic me-1"></i>Add Custom / Homebrew Spell
                            </button>

                            <div class="collapse" id="customSpellCollapse">
                              <div class="border border-secondary rounded p-2 bg-black bg-opacity-25">
                                <div class="row g-2 mb-2">
                                  <div class="col-12">
                                    <label for="customSpellNameInput" class="form-label small mb-1">Name / Title</label>
                                    <input type="text"
                                           class="form-control form-control-sm"
                                           id="customSpellNameInput"
                                           placeholder="Spell name (required)" />
                                  </div>
                                  <div class="col-4">
                                    <label for="customSpellLevelInput" class="form-label small mb-1">Level</label>
                                    <input type="number"
                                           min="0"
                                           max="9"
                                           class="form-control form-control-sm"
                                           id="customSpellLevelInput" />
                                  </div>
                                  <div class="col-8">
                                    <label for="customSpellSchoolInput" class="form-label small mb-1">School</label>
                                    <input type="text"
                                           class="form-control form-control-sm"
                                           id="customSpellSchoolInput"
                                           placeholder="Evocation, Illusion..." />
                                  </div>
                                  <div class="col-6">
                                    <label for="customSpellCastingInput" class="form-label small mb-1">Casting Time</label>
                                    <input type="text"
                                           class="form-control form-control-sm"
                                           id="customSpellCastingInput"
                                           placeholder="1 action, bonus action..." />
                                  </div>
                                  <div class="col-6">
                                    <label for="customSpellRangeInput" class="form-label small mb-1">Range</label>
                                    <input type="text"
                                           class="form-control form-control-sm"
                                           id="customSpellRangeInput"
                                           placeholder="60 ft, Self (30-ft cone)..." />
                                  </div>
                                  <div class="col-6">
                                    <label for="customSpellComponentsInput" class="form-label small mb-1">Components</label>
                                    <input type="text"
                                           class="form-control form-control-sm"
                                           id="customSpellComponentsInput"
                                           placeholder="V,S,M (a pearl worth 100 gp)" />
                                  </div>
                                  <div class="col-6">
                                    <label for="customSpellDurationInput" class="form-label small mb-1">Duration</label>
                                    <input type="text"
                                           class="form-control form-control-sm"
                                           id="customSpellDurationInput"
                                           placeholder="Instantaneous, 1 minute, up to 1 hour..." />
                                  </div>
                                  <div class="col-6 d-flex align-items-center">
                                    <div class="form-check mt-3">
                                      <input class="form-check-input"
                                             type="checkbox"
                                             id="customSpellConcentrationInput" />
                                      <label class="form-check-label small" for="customSpellConcentrationInput">
                                        Concentration
                                      </label>
                                    </div>
                                  </div>
                                  <div class="col-6">
                                    <label for="customSpellClassesInput" class="form-label small mb-1">Classes</label>
                                    <input type="text"
                                           class="form-control form-control-sm"
                                           id="customSpellClassesInput"
                                           placeholder="Wizard, Cleric (comma-separated)" />
                                  </div>
                                  <div class="col-12">
                                    <label for="customSpellTagsInput" class="form-label small mb-1">Tags</label>
                                    <input type="text"
                                           class="form-control form-control-sm"
                                           id="customSpellTagsInput"
                                           placeholder="damage, control, fire (comma-separated)" />
                                  </div>
                                  <div class="col-12">
                                    <label for="customSpellBodyInput" class="form-label small mb-1">Description</label>
                                    <textarea class="form-control form-control-sm"
                                              id="customSpellBodyInput"
                                              rows="3"
                                              placeholder="Full spell rules text / summary."></textarea>
                                  </div>
                                </div>

                                <div class="d-flex justify-content-end">
                                  <button class="btn btn-sm btn-success"
                                          type="button"
                                          id="saveCustomSpellBtn">
                                    <i class="bi bi-plus-circle me-1"></i>Add to Known Spells
                                  </button>
                                </div>

                                <small class="text-muted d-block mt-1">
                                  Custom spells are stored only on this character’s spell list.
                                </small>
                              </div>
                            </div>
                          </div>
                      
                          <div class="mt-3">
                            <div class="d-flex justify-content-between align-items-center mb-1">
                              <span class="fw-bold small">Known Spells</span>
                              <button type="button"
                                      class="btn btn-sm btn-outline-danger"
                                      id="clearSpellListBtn">
                                Clear All
                              </button>
                            </div>
                            <ul class="list-group list-group-flush small" id="characterSpellList">
                              <!-- Populated by JS -->
                            </ul>
                          </div>
                      
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Inventory -->
                  <div class="tab-pane fade"
                       id="detail-inventory-pane"
                       role="tabpanel"
                       aria-labelledby="detail-inventory-tab">
                    <div class="mt-2" id="section-inventory">
                      <label for="charInventory" class="form-label">Key Gear / Magic Items</label>
                      <textarea id="charInventory" rows="3" class="form-control form-control-sm"
                                placeholder="Weapons, armor, magic items, consumables that matter regularly."></textarea>
                    </div>
                  </div>

                  <!-- Features & Traits -->
                  <div class="tab-pane fade"
                       id="detail-features-pane"
                       role="tabpanel"
                       aria-labelledby="detail-features-tab">
                    <div class="mt-2" id="section-features">
                      <label for="charFeatures" class="form-label">Features & Feats</label>
                      <textarea id="charFeatures" rows="4" class="form-control form-control-sm"
                                placeholder="Key class features, feats, reactions, bonus actions, etc. Focus on what matters for you behind the screen."></textarea>
                    </div>
                  </div>

                  <!-- Background -->
                  <div class="tab-pane fade"
                       id="detail-background-pane"
                       role="tabpanel"
                       aria-labelledby="detail-background-tab">
                    <div class="mt-2" id="section-background">
                      <label for="charNotes" class="form-label">Story, Hooks &amp; Secrets</label>
                      <textarea id="charNotes" rows="4" class="form-control form-control-sm"
                                placeholder="Backstory beats, faction ties, secrets, upcoming reveals, relationship notes, etc."></textarea>
                    </div>
                  </div>

                  <!-- Generic Notes -->
                  <div class="tab-pane fade"
                       id="detail-notes-pane"
                       role="tabpanel"
                       aria-labelledby="detail-notes-tab">
                    <div class="mt-2">
                      <label for="charExtraNotes" class="form-label">Miscellaneous Notes</label>
                      <textarea id="charExtraNotes" rows="4" class="form-control form-control-sm"
                                placeholder="Scratch space, prep notes, anything that doesn’t fit the other tabs."></textarea>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div> <!-- /row -->
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="container-fluid mt-5 site-footer" role="contentinfo">
    <div class="footer-main py-3">
      <div class="container">
        <div class="row align-items-center text-center text-md-start">
          <!-- Left: Copyright -->
          <div class="col-12 col-md-4 mb-2 mb-md-0 text-md-start text-center">
            <small class="text-muted">&copy; 2025 Maybeme | The DM’s Toolbox</small>
          </div>

          <!-- Center: Logo -->
          <div class="col-12 col-md-4 text-center mb-2 mb-md-0">
            <img src="/images/White logo - no background.png" height="40" alt="Logo" class="footer-logo">
          </div>

          <!-- Right: Social Links -->
          <div class="col-12 col-md-4 d-flex justify-content-center justify-content-md-end align-items-center gap-2">
            <a href="https://www.linkedin.com/in/marlo-mayberry-930ab9b7/" class="socialicons" target="_blank" rel="noopener" aria-label="LinkedIn">
              <i class="bi bi-linkedin"></i>
            </a>
            <a href="https://github.com/M-ybeme" class="socialicons" target="_blank" rel="noopener" aria-label="GitHub">
              <i class="bi bi-github"></i>
            </a>
            <a href="https://ko-fi.com/maybemestoolbox" class="socialicons d-flex align-items-center" target="_blank" rel="noopener" title="Support The DM’s Toolbox on Ko-fi">
              <i class="bi bi-cup-hot"></i>
            </a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- Portrait Editing Modal -->
  <div class="modal fade" id="portraitModal" tabindex="-1" aria-labelledby="portraitModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content bg-dark text-light border-secondary">
        <div class="modal-header border-secondary">
          <h5 class="modal-title" id="portraitModalLabel">Adjust Portrait Framing</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3 portrait-frame" style="height: 420px; cursor: grab;" id="portraitContainerModal">
            <img id="portraitPreviewModal"
                 class="portrait-image d-none"
                 alt="Portrait being edited" />
            <span id="portraitPlaceholderModal"
                  class="text-muted position-absolute top-50 start-50 translate-middle text-center">
              No image loaded
            </span>
          </div>

          <div class="mb-3">
            <label for="portraitZoomModal" class="form-label mb-1">Zoom</label>
            <input type="range" id="portraitZoomModal" min="1" max="3" step="0.05" class="form-range" />
            <small class="text-muted">Drag inside the frame to reposition the portrait.</small>
          </div>
        </div>
        <div class="modal-footer border-secondary">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-success" id="savePortraitModalBtn">
            <i class="bi bi-check2-circle me-1"></i>Save Portrait
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="/js/spells-data.js"></script>
  <script src="/js/character.js"></script>
</body>
</html>
