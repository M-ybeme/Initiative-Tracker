<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The DM's Toolbox: NPC Generator</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css" />
  <!-- Custom CSS -->
  <link href="/css/site.css" rel="stylesheet" />
  <!-- Dev Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/devicons/devicon@v2.15.1/devicon.min.css" />
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/images/dndFavicon (2).png" />
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <style>
    .bgimage{
        background: url('images/BGMap.png') no-repeat center center fixed;
        background-size: cover;}
    .bg-orange { background-color: #fd7e14 !important; color: #212529 !important; }
    .drag-handle { cursor: move; }
    .active-turn {
      border-left: 5px solid #1d9e6d !important;
      color: #f8f9fa !important;
      font-weight: bold;
    }
    #saveHistorySelect { min-width: 200px; }
  </style>
</head>
<body class="bgimage">
   <nav class="navbar navbar-expand-lg navbar-dark fixed-top text-light" id="mainNav">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">
        <img src="/images/dndFavicon (2).png" height="40" width="40" alt="App Logo" class="d-inline-block" />
        The DM Toolbox
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon">
          <i class="bi bi-list"></i>
        </span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" href="index.html">Initiative</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="name.html">Name Gen</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="loot.html">Loot Gen</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="shop.html">Shop Gen</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="npc.html">NPC Gen</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="tav.html">Tavern/Inn Gen</a>
          </li>
        </ul>
      </div>
    </div>
   </nav>
  <main class="content pt-3">
    <div class="container-fluid text-center backdrop">
        <!-- ===== NPC Generator (drop-in) ===== -->
<div class="row g-3">
  <!-- Settings -->
  <div class="col-12 col-lg-4">
    <div class="card bg-dark border-secondary h-100">
      <div class="card-header border-secondary">
        <h5 class="mb-0">NPC Settings</h5>
      </div>
      <div class="card-body">
        <div class="mb-2">
          <label for="npc-settlement" class="form-label">Settlement profile</label>
          <select id="npc-settlement" class="form-select">
            <option value="village">Village</option>
            <option value="town" selected>Town</option>
            <option value="capital">Capital</option>
          </select>
        </div>

        <div class="row g-2">
          <div class="col-6">
            <label for="npc-count" class="form-label">NPCs</label>
            <input id="npc-count" class="form-control" type="number" inputmode="numeric" min="1" max="500" value="12">
          </div>
          <div class="col-6">
            <label for="npc-seed" class="form-label">Seed (optional)</label>
            <input id="npc-seed" class="form-control" type="text" placeholder="e.g. session-14">
          </div>
        </div>

        <div class="form-check mt-2">
          <input class="form-check-input" type="checkbox" id="npc-roleInDesc" checked>
          <label class="form-check-label" for="npc-roleInDesc">Mention role in description</label>
        </div>

        <div class="d-grid d-sm-flex gap-2 mt-3">
          <button class="btn btn-success w-100 w-sm-auto" id="npc-generate"><i class="bi bi-people-fill me-1"></i>Generate</button>
          <button class="btn btn-outline-light w-100 w-sm-auto" id="npc-copy"><i class="bi bi-clipboard me-1"></i>Copy</button>
          <button class="btn btn-warning w-100 w-sm-auto" id="npc-download"><i class="bi bi-download me-1"></i>Download .txt</button>
          <button class="btn btn-danger w-100 w-sm-auto" id="npc-clear"><i class="bi bi-trash me-1"></i>Clear</button>
        </div>

        <div class="alert alert-info mt-3 text-start">
          <div class="fw-semibold mb-1"><i class="bi bi-magic"></i> Tip</div>
          Generate here, then give them a name with your **Name Generator** tab.
        </div>
      </div>
    </div>
  </div>

  <!-- Results -->
  <div class="col-12 col-lg-8">
    <div class="card bg-dark border-secondary h-100">
      <div class="card-header border-secondary">
        <h5 class="mb-0">NPCs</h5>
      </div>
      <div class="card-body">
        <div id="npc-meta" class="d-flex flex-wrap gap-2 small text-secondary mb-2"></div>
        <div id="npc-out" class="row row-cols-1 row-cols-sm-2 row-cols-lg-2 g-2" aria-live="polite"></div>
      </div>
    </div>
  </div>
</div>

<style>
  .npc-pill{border:1px solid rgba(255,255,255,.15);border-radius:50rem;padding:.15rem .5rem}
  .npc-tile{border:1px solid rgba(255,255,255,.15);border-radius:.6rem;padding:.6rem;background:rgba(0,0,0,.2)}
  .npc-field{font-size:.9rem}
  .npc-field b{color:#aeb4be}
</style>

<script>
(()=>{
// ---------- Seeded RNG ----------
function hashString(str){let h=1779033703^str.length;for(let i=0;i<str.length;i++){h=Math.imul(h^str.charCodeAt(i),3432918353);h=h<<13|h>>>19;}return (h>>>0)>>>0}
function mulberry32(a){return function(){let t=a+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return ((t^t>>>14)>>>0)/4294967296}}
function prand(seedStr){const s = seedStr? hashString(seedStr) : Math.floor(Math.random()*2**32); return mulberry32(s) }
const $ = (id)=>document.getElementById(id);
function pick(rng, arr){ return arr[Math.floor(rng()*arr.length)] }
function pickN(rng, arr, n){
  const pool=[...arr]; const out=[];
  for(let i=0;i<n && pool.length;i++){
    const idx=Math.floor(rng()*pool.length); out.push(pool.splice(idx,1)[0]);
  }
  return out;
}
function clamp(v,min,max){return Math.max(min,Math.min(max,v))}

// ---------- Pools (neutral, table-safe, no plot hooks) ----------
const AGE = [
  "young adult","middle-aged","older","elderly",
  "early adult","late adult","seasoned","prime of life","weathered","spry elder",
  "silver-haired","long-in-the-tooth","fresh-faced","timeworn","stooped","youthful-looking"
];

const BUILD = [
  "slight","lean","average","sturdy","broad-shouldered","lithe","stocky",
  "willowy","wiry","lanky","compact","athletic","barrel-chested","paunchy",
  "burly","round-shouldered","sinewy","thickset","petite","imposing","gaunt"
];

const HAIR_STYLE = [
  "short-cropped","curly","straight","braided","shaved","shoulder-length","coiled",
  "topknot","undercut","loose waves","ringlets","high bun","messy bun","side-parted",
  "center-parted","cropped fringe","twists","single long braid","double braids","braid crown","tousled"
];

const HAIR_COLOR = [
  "dark","fair","ginger","gray-streaked","white","sandy","jet-black","chestnut",
  "auburn","ash-blond","straw blond","honey-brown","copper","platinum","raven",
  "salt-and-pepper","silver","ashen","indigo-dyed","henna-red","mousy brown"
];

const EYES = [
  "grey","brown","green","blue","hazel",
  "amber","gold-flecked","steel-blue","ice-blue","grey-green","hazel-brown","near-black",
  "violet","sea-green","stormy grey","pale blue"
];

const FEATURES = [
  "ink-stained fingers","sun-browned skin","freckles","callused hands","neat beard","piercing gaze",
  "soft smile","scar on knuckle","weathered cheeks","tidy braids",
  "missing front tooth","crooked nose","scar over eyebrow","laugh lines","pierced ear",
  "tattoo ring on finger","rough nails","smudged spectacles","steady hands","nicked knuckles",
  "rosy cheeks","chapped lips","perpetual squint"
];

const ATTIRE = [
  "work-stained apron","patched cloak","neat tunic","travel-worn coat","simple uniform","layered shawl",
  "tool belt and vest","well-kept robes","weathered jacket","rolled-up sleeves",
  "embroidered cuffs","sturdy boots","broad-brim hat","wool cap","scarf tucked at neck",
  "fingerless gloves","belt with pouches","neatly tied cravat","weathered hood","apron with many loops",
  "reinforced coat","patched knees","polished buckle"
];

const DEMEANOR = [
  "brisk","courteous","distracted","cheerful","wary","even-tempered","no-nonsense","patient",
  "eager","world-weary","soft-spoken","forthright",
  "brusque","amiable","fidgety","methodical","stoic","sardonic","warm","proud",
  "anxious","unflappable","obliging","perky","gruff","deadpan"
];

const VOICE_TEMPO = [
  "measured","quick","slow","unhurried","brisk",
  "staccato","halting","stop-start","rambling","clipped","rapid-fire","languid","jerky","steady","sing-song"
];

const VOICE_TIMBRE = [
  "warm","raspy","nasal","gravelly","breathy","clear","booming","soft",
  "reedy","velvety","hoarse","smoky","thin","round","bright","dark","metallic","woody","whispery","husky","buzzy"
];

const VOICE_PITCH = [
  "low","mid","high",
  "very low","baritone","tenor","alto","contralto","soprano","falsetto","flat mid","rising high","deeply chesty","whistle-high"
];

const VOICE_ACCENT = [
  "local lilt","coastal drawl","northern clip","merchant cant","scholarly cadence","street patter","formal diction","sing-song inflection",
  "mountain burr","riverlands brogue","border cant","dockside slang","market hawker patter","islander cadence","desert drawl",
  "high-court formality","temple intonation","academy enunciation","northern frontier burr","rural twang"
];

const VOICE_DELIVERY = [
  "chooses words carefully","talks in short sentences","trails off at the end","emphasizes key words",
  "asks confirming questions","murmurs while thinking","drops final consonants slightly","rolls r’s a touch",
  "speaks in metaphors","overexplains steps","answers with questions","clips small words",
  "enunciates every syllable","draws out vowels","drops to a whisper for emphasis","counts softly while speaking",
  "laughs at their own remarks","pauses for effect","repeats key phrases","adds honorifics reflexively","uses trade jargon"
];

const MANNERISMS = [
  "rubs thumb and forefinger","tilts head before answering","squints when listening","drums fingers on surfaces",
  "keeps hands clasped","straightens nearby objects","tugs at sleeves","taps foot softly","pauses to think mid-sentence",
  "glances over a shoulder now and then","nods repeatedly","counts on fingers","clears throat quietly","hums under breath",
  "chews the inside of their cheek",
  "rolls shoulders to loosen up","adjusts spectacles","checks pocket contents","touches a lucky charm","balances on heels",
  "cracks knuckles quietly","stares into middle distance","keeps posture ramrod-straight","fidgets with a ring",
  "taps a quill or pen","sniffs thoughtfully","smooths hair back","sways gently while standing","tilts chin upward","purses lips"
];

const QUIRKS = [
  "collects buttons","keeps a neat ledger of tiny favors","names their tools","insists on exact change",
  "carries a smooth lucky pebble","takes dawn walks daily","brews a personal tea blend","never swears",
  "wears mismatched socks","polishes gear at the same hour","saves interesting labels","folds notes into tiny squares",
  "presses dried flowers in a book",
  "saves short lengths of twine","keeps a pocket almanac","whistles the same tune when working",
  "carves tiny animals from scraps","makes coin rubbings","collects unusual pebbles",
  "folds tiny paper boats","brews odd herbal syrups","labels everything with neat tags",
  "logs the weather each day","lines items up by height","repairs broken buckles for fun"
];

const WANTS = [
  "to make a fair sale","a quiet day of steady work","better tools","news from the road","to impress a supervisor",
  "to trade for supplies","to hire short-term help","to clear a small debt","to finish on time",
  "to maintain a good reputation","to teach an apprentice","repeat customers","to avoid shortages",
  "a day off soon","a fair hearing","more storage space","to learn a new skill","a steady supplier",
  "to keep family comfortable","to expand the shop","a reliable apprentice","to work without interruption",
  "to finish a personal project","clear instructions","a good recommendation","stable prices"
];

const AVOIDS = [
  "attention from officials","long haggling","rowdy crowds","credit purchases","wasting materials","lateness",
  "broken promises","public arguments","being overheard","theft","refund disputes","wet weather","idle gossip about them",
  "mud tracked indoors","smoldering coals near stock","spilled ink on ledgers","damp storage","spoiled goods",
  "rust","inaccurate scales","counterfeit coins","price undercutting","idle loitering at the door",
  "taking sides in disputes","overlong stories while working","open flames near spirits"
];

// Roles by settlement (used only inside the description if enabled)
const ROLES = {
  village: [
    "farmer","herder","miller","fisher","herbalist","carpenter","tanner","hunter","stable hand",
    "village guard","innkeeper","baker","weaver","potter","beekeeper",
    "shepherd","swineherd","goatherd","thatcher","thresher","wool-spinner","cooper","carter",
    "reed-cutter","charcoal-burner","net maker","woodcutter","stonecutter","basket-weaver","midwife","broom-maker","fieldhand","drover"
  ],
  town: [
    "blacksmith","apothecary clerk","dockhand","shopkeeper","scribe","courier","guard corporal","ferryman",
    "brewer","tailor","cobbler","mason","cartwright","bookbinder","glassworker",
    "chandler (candlemaker)","cooper","dyer","ropemaker","tinker","wagoner","porter","engraver",
    "furrier","plasterer","glazier","sawyer","barber","cook","inn server","printer","teamster","warehouse tallyman"
  ],
  capital: [
    "guild clerk","factor","archivist","court messenger","city watch sergeant","street vendor","stage performer",
    "temple attendant","arcane student","moneychanger teller","court scribe","porter","restaurateur",
    "notary","customs inspector","tax office aide","armorer journeyman","stablemaster","coachman","perfumer",
    "magistrate’s aide","courier dispatcher","stagehand","house steward","guild examiner","astronomer’s assistant",
    "map-room attendant","cathedral cantor","royal gardener","ledger auditor","apartment concierge"
  ]
};

// ---------- NPC assembly ----------
function makeDescription(rng, settlement, mentionRole){
  const role = pick(rng, ROLES[settlement]);
  const age = pick(rng, AGE);
  const build = pick(rng, BUILD);
  const hair = `${pick(rng, HAIR_STYLE)} ${pick(rng, HAIR_COLOR)} hair`;
  const eyes = `${pick(rng, EYES)} eyes`;
  const feat = pick(rng, FEATURES);
  const attire = pick(rng, ATTIRE);
  const demeanor = pick(rng, DEMEANOR);
  const roleBit = mentionRole ? ` ${role}` : "";
  return `A ${age}, ${build}${roleBit} with ${hair}, ${eyes}, and ${feat}. Wears a ${attire}; ${demeanor} manner.`;
}
function makeVoice(rng){
  const tempo = pick(rng, VOICE_TEMPO), timbre = pick(rng, VOICE_TIMBRE), pitch = pick(rng, VOICE_PITCH);
  const accent = pick(rng, VOICE_ACCENT), delivery = pick(rng, VOICE_DELIVERY);
  return `${tempo}, ${timbre}, ${pitch} pitch; ${accent}; ${delivery}.`;
}
function makeMannerisms(rng){
  return pickN(rng, MANNERISMS, 2).join("; ") + ".";
}
function makeQuirk(rng){ return pick(rng, QUIRKS) + "."; }
function makeWants(rng){ return pickN(rng, WANTS, 2).join("; ") + "."; }
function makeAvoids(rng){ return pickN(rng, AVOIDS, 2).join("; ") + "."; }

function generate(){
  const settlement = $("npc-settlement").value;
  const count = clamp(+$("npc-count").value || 12, 1, 500);
  const seed = $("npc-seed").value.trim();
  const roleInDesc = $("npc-roleInDesc").checked;

  const rng = prand(seed);
  const out = $("npc-out"); out.innerHTML = "";
  const meta = $("npc-meta"); meta.innerHTML = "";

  [["Settlement", settlement],["Count", count],["Seed", seed||"(random)"]]
    .forEach(([k,v])=>{ const s=document.createElement("span"); s.className="npc-pill"; s.textContent=`${k}: ${v}`; meta.appendChild(s); });

  const rows = [];
  for(let i=0;i<count;i++){
    const desc = makeDescription(rng, settlement, roleInDesc);
    const voice = makeVoice(rng);
    const mans = makeMannerisms(rng);
    const quirk = makeQuirk(rng);
    const wants = makeWants(rng);
    const avoids = makeAvoids(rng);

    // render card
    const col = document.createElement("div"); col.className = "col";
    const div = document.createElement("div"); div.className = "npc-tile";
    div.innerHTML = `
      <div class="npc-field"><b>Description:</b> ${desc}</div>
      <div class="npc-field"><b>Voice:</b> ${voice}</div>
      <div class="npc-field"><b>Mannerisms:</b> ${mans}</div>
      <div class="npc-field"><b>Quirk:</b> ${quirk}</div>
      <div class="npc-field"><b>Wants:</b> ${wants}</div>
      <div class="npc-field"><b>Wants to Avoid:</b> ${avoids}</div>
    `;
    col.appendChild(div); out.appendChild(col);

    rows.push([
      `Description: ${desc}`,
      `Voice: ${voice}`,
      `Mannerisms: ${mans}`,
      `Quirk: ${quirk}`,
      `Wants: ${wants}`,
      `Wants to Avoid: ${avoids}`
    ].join("\n"));
  }
  return rows;
}

// Copy / Download helpers
function copyNPCs(){
  const rows = [...document.querySelectorAll("#npc-out .npc-tile")].map(tile=>{
    return tile.innerText.replace(/\n{2,}/g,"\n");
  });
  if(!rows.length) return;
  navigator.clipboard.writeText(rows.join("\n\n---\n\n"));
}
function downloadNPCs(){
  const text = [...document.querySelectorAll("#npc-out .npc-tile")].map(tile=>tile.innerText).join("\n\n---\n\n");
  if(!text.trim()) return;
  const blob = new Blob([text], {type:"text/plain"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a"); a.href=url; a.download="npcs.txt"; a.click(); URL.revokeObjectURL(url);
}

// Wire up
document.addEventListener("DOMContentLoaded", ()=>{
  $("npc-generate").addEventListener("click", generate);
  $("npc-copy").addEventListener("click", copyNPCs);
  $("npc-download").addEventListener("click", downloadNPCs);
  $("npc-clear").addEventListener("click", ()=>{ $("npc-out").innerHTML=""; $("npc-meta").innerHTML=""; });

  // initial batch
  generate();
});
})();
</script>
<!-- ===== /NPC Generator ===== -->

    </div>
  </main>
  <!-- Footer -->
  <footer class="container-fluid mt-5 site-footer" role="contentinfo"> 
    <div class="row footer-main"> 
      <div class="col">
        <div class="container">
          <div class="row align-items-center">
            <div class="col-12 col-md-4 text-md-start text-center order-last order-md-first">
              &copy; 2025 Marlo Mayberry 
            </div>
            <div class="col-12 col-md-4 text-center">
              <img src="/images/White logo - no background.png" height="50">
            </div>
            <div class="col-12 col-md-4 d-flex justify-content-center justify-content-md-end">
              <a href="https://www.linkedin.com/in/marlo-mayberry-930ab9b7/" class="socialicons"  target="_blank"><i class="bi bi-linkedin p-2"></i></a>
              <a href="https://github.com/M-ybeme" class="socialicons" target="_blank"><i class="bi bi-github p-2"></i></a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </footer>
</body>
</html>